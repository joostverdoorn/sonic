!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Sonic=e()}}(function(){return function e(t,n,r){function u(o,a){if(!n[o]){if(!t[o]){var f="function"==typeof require&&require;if(!a&&f)return f(o,!0);if(i)return i(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return u(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)u(r[o]);return u}({1:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,i=e("./key"),o=r(i);n.AsyncIterator=u,function(e){function t(e,t){return e=Object.create(e),"get"in t&&(e.get=t.get),"next"in t&&(e.next=t.next),e}function n(e,t){function n(){return e.next().then(function(r){return null==r||e.get().then(function(e){return t(e,r)}).then(function(e){return e?n():!1})})}return n()}function r(e,t){return n(e,function(e,n){return Promise.resolve(t(e,n)).then(function(e){return!e})}).then(function(e){return!e})}function u(e,t){return n(e,function(e,n){return Promise.resolve(t(e,n)).then(function(){return!0})}).then(function(){})}function i(e,t,n){return u(e,function(e,r){return Promise.resolve(t(n,e,r)).then(function(e){n=e})}).then(function(){return n})}function a(e,t){var n;return r(e,function(e,r){return Promise.resolve(t(e,r)).then(function(e){return e?(n=r,!0):!1})}).then(function(e){return e?n:o["default"].sentinel})}function f(e,t){return a(e,t).then(e.get)}function c(e,t){return a(e,function(e){return e===t})}function l(e,t){var n=-1;return r(e,function(e,r){return n++,t==e}).then(function(e){return e?n:o["default"].NOT_FOUND})}function s(e,t){return a(e,function(){return 0===t--})}function d(e,t){return s(e,t).then(e.get)}function v(e,t){return r(e,function(e){return e===t})}function p(){for(var t=arguments.length,n=Array(t),r=0;t>r;r++)n[r]=arguments[r];return n.reduce(function(e,t){var n=!1;return{get:function(){return n?t.get():e.get()},next:function(){return n?t.next():e.next().then(function(e){return e!==o["default"].sentinel?e:(n=!0,t.next())})}}},e.Empty)}function g(e){var t=-1;return{get:function(){return-1===t?o["default"].NOT_FOUND:Promise.resolve(e[t][1])},next:function(){return Promise.resolve(++t===e.length?o["default"].sentinel:e[t][0])}}}function h(e){return g(e.map(function(e,t){return[t,e]}))}function m(e){return g(Object.keys(e).map(function(t){return[t,e[t]]}))}function P(e){return i(e,function(e,t){return e.push(t),e},[])}function x(e){return i(e,function(e,t,n){return e[n]=t,e},Object.create(null))}e.Empty={get:function(){return o["default"].NOT_FOUND},next:function(){return Promise.resolve(o["default"].sentinel)}},e.extend=t,e.every=n,e.some=r,e.forEach=u,e.reduce=i,e.findKey=a,e.find=f,e.keyOf=c,e.indexOf=l,e.keyAt=s,e.at=d,e.contains=v,e.concat=p,e.fromEntries=g,e.fromArray=h,e.fromObject=m,e.toArray=P,e.toObject=x}(u||(n.AsyncIterator=u={})),n["default"]=u},{"./key":3}],2:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,i=e("./key"),o=r(i);n.Cache=u,function(e){function t(){return{get:Object.create(null),prev:Object.create(null),next:Object.create(null)}}function n(e){return{get:Object.create(e.get),prev:Object.create(e.prev),next:Object.create(e.next)}}function r(e,t){function n(n){return n in t.get?t.get[n]:t.get[n]=e.get(n)}function r(){var n=arguments.length<=0||void 0===arguments[0]?o["default"].sentinel:arguments[0];return n in t.prev?t.prev[n]:t.prev[n]=e.prev(n).then(function(e){return t.next[e]=Promise.resolve(n),e})}function u(){var n=arguments.length<=0||void 0===arguments[0]?o["default"].sentinel:arguments[0];return n in t.next?t.next[n]:t.next[n]=e.next(n).then(function(e){return t.prev[e]=Promise.resolve(n),e})}return{get:n,prev:r,next:u}}e.create=t,e.extend=n,e.apply=r}(u||(n.Cache=u={})),n["default"]=u},{"./key":3}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,i=e("./promise_utils"),o=r(i);!function(e){function t(e){return e.toString()}function n(){return r++}e.NOT_FOUND_ERROR=new Error("No entry at the specified key"),e.NOT_FOUND=o["default"].lazy(function(t,n){return n(e.NOT_FOUND_ERROR)}),e.sentinel=null;var r=0;e.key=t,e.create=n}(u||(u={})),n["default"]=u,t.exports=n["default"]},{"./promise_utils":8}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,i=e("./state"),o=r(i),a=e("./list"),f=e("./observable");n.Lens=u,function(e){function t(e,t){var n=f.Subject.create(),r=f.Subject.create();return f.Observable.map(e.patches,function(e){return e.added?{range:e.range,added:o["default"].map(e.added,t.get)}:{range:e.range}}).subscribe(n),f.Observable.map(r,function(e){return e.added?{range:e.range,added:o["default"].map(e.added,t.set)}:{range:e.range}}).subscribe(e.patches),a.List.create(o["default"].map(e.state,t.get),{subscribe:n.subscribe,onNext:r.onNext})}e.compose=t}(u||(n.Lens=u={})),n["default"]=u},{"./list":5,"./observable":6,"./state":11}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,i=e("./key"),o=r(i),a=e("./patch"),f=r(a),c=e("./state"),l=r(c),s=e("./range"),d=e("./tree"),v=e("./observable"),p=e("./async_iterator"),g=r(p);n.List=u,function(e){function t(e,t){var n=l["default"].map(e.state,t),r=v.Observable.map(e.patches,function(e){return{range:e.range,added:e.added?l["default"].map(e.added,t):void 0}});return a(n,r)}function n(e,t){var n=l["default"].filter(e.state,t),r=v.Observable.map(e.patches,function(e){return Promise.all([g["default"].findKey(l["default"].toIterator(l["default"].reverse(n),[s.Position.reverse(e.range[0]),{prev:null}]),t).then(function(e){return{next:e}}),g["default"].findKey(l["default"].toIterator(n,[e.range[1],{prev:null}]),t).then(function(e){return{prev:e}})]).then(function(n){return{range:n,added:e.added?l["default"].filter(e.added,t):void 0}})});return a(n,r,function(e,t){return n=f["default"].apply(e,t)})}function r(e,t){var n=e.state,r=l["default"].zoom(e.state,t),u=v.Observable.map(v.Observable.filter(e.patches,function(e){return g["default"].some(l["default"].toIterator(n,e.range),function(e,n){return n===t}).then(function(n){return e.added?l["default"].has(e.added,t):n})}),function(r){return n=e.state,{range:s.Range.all,added:r.added?l["default"].zoom(r.added,t):void 0}});return a(r,u)}function u(e){var n=v.Subject.create(),r=i(t(e,function(e,t){return v.Observable.map(e.patches,function(n){function r(n){return n.prev===o["default"].sentinel?e.state.prev(o["default"].sentinel).then(function(e){return{next:d.Path.toKey([t,e])}}):Promise.resolve({prev:d.Path.toKey([t,n.prev])})}function u(n){return n.next===o["default"].sentinel?e.state.next(o["default"].sentinel).then(function(e){return{prev:d.Path.toKey([t,e])}}):Promise.resolve({next:d.Path.toKey([t,n.next])})}var i=n.range[0],a=n.range[1];return Promise.all([s.Position.isNextPosition(i)?u(i):r(i),s.Position.isNextPosition(a)?u(a):r(a)]).then(function(e){return{range:e,added:n.added?n.added:void 0}})}).subscribe(n),e.state}));v.Observable.map(e.patches,function(e){function t(e){return e.prev===o["default"].sentinel?Promise.resolve({prev:o["default"].sentinel}):d.Tree.next(r.state,[e.prev]).then(d.Path.toKey).then(function(e){return{prev:e}})}function n(e){return e.next===o["default"].sentinel?Promise.resolve({next:o["default"].sentinel}):d.Tree.prev(r.state,[e.next]).then(d.Path.toKey).then(function(e){return{next:e}})}var u=e.range[0],i=e.range[1];return Promise.all([s.Position.isNextPosition(u)?n(u):t(u),s.Position.isNextPosition(i)?n(i):t(i)]).then(function(t){return{range:t,added:e.added?l["default"].flatten(l["default"].map(e.added,function(e){return e.state})):void 0}})}).subscribe(n);var u=l["default"].flatten(r.state);return a(u,n)}function i(t){var n=l["default"].cache(t.state),r=v.Observable.map(t.patches,function(e){return{range:e.range,added:l["default"].cache(e.added)}});return e.create(n,r)}function a(e,t){var n=arguments.length<=2||void 0===arguments[2]?f["default"].apply:arguments[2],r={state:e,patches:t};return v.Observable.scan(t,n,e).subscribe({onNext:function(e){r.state=e}}),r}e.map=t,e.filter=n,e.zoom=r,e.flatten=u,e.cache=i,e.create=a}(u||(n.List=u={})),n["default"]=u},{"./async_iterator":1,"./key":3,"./observable":6,"./patch":7,"./range":9,"./state":11,"./tree":12}],6:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,i=e("./key"),o=r(i);n.Disposable=u,function(e){function t(e){var t=!1;return{dispose:function(){t||(t=!0,e())}}}e.create=t}(u||(n.Disposable=u={}));var a;n.Observable=a,function(e){function t(e,t){var n=f.create();return e.subscribe({onNext:function(e){return Promise.resolve(t(e)).then(n.onNext)}}),{subscribe:n.subscribe}}function n(e,t){var n=f.create();return e.subscribe({onNext:function(e){return Promise.resolve(t(e)).then(function(t){return t?n.onNext(e):void 0})}}),{subscribe:n.subscribe}}function r(e,t,n){var r=f.create();return e.subscribe({onNext:function(e){return Promise.resolve(t(n,e)).then(function(e){n=e,r.onNext(e)})}}),{subscribe:r.subscribe}}e.map=t,e.filter=n,e.scan=r}(a||(n.Observable=a={}));var f;n.Subject=f,function(e){function t(){function e(e){var t=o["default"].create();return n[t]=e,u.create(function(){return delete n[t]})}function t(e){return r=r.then(function(){return Promise.all(Object.keys(n).map(function(t){return n[t].onNext(e)})).then(function(){})})}var n=Object.create(null),r=Promise.resolve();return{subscribe:e,onNext:t}}e.create=t}(f||(n.Subject=f={}))},{"./key":3}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,i=e("./state"),o=r(i);n.Patch=u,function(e){function t(e,t){return o["default"].splice(e,t.range,t.added)}e.apply=t}(u||(n.Patch=u={})),n["default"]=u},{"./state":11}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r;n.PromiseUtils=r,function(e){function t(e){function t(t,r){return n?n.then(t,r):(n=new Promise(e)).then(t,r)}var n;return Promise.resolve({then:t})}e.lazy=t}(r||(n.PromiseUtils=r={})),n["default"]=r},{}],9:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,i=e("./key"),o=r(i);n.Range=u,function(e){e.all=[{next:o["default"].sentinel},{prev:o["default"].sentinel}]}(u||(n.Range=u={}));var a;n.Position=a,function(e){function t(e){return"prev"in e}function n(e){return"next"in e}function r(t){return e.isPrevPosition(t)?{next:t.prev}:{prev:t.next}}e.isPrevPosition=t,e.isNextPosition=n,e.reverse=r}(a||(n.Position=a={})),n["default"]=u},{"./key":3}],10:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e){return e instanceof Array?c.List.create(o["default"].fromArray(e),p.Subject.create()):e instanceof Object?c.List.create(o["default"].fromObject(e),p.Subject.create()):void 0}Object.defineProperty(n,"__esModule",{value:!0}),n.Sonic=u;var u,i=e("./state"),o=r(i),a=e("./async_iterator"),f=r(a),c=e("./list"),l=e("./tree"),s=r(l),d=e("./cache"),v=r(d),p=e("./observable"),g=e("./promise_utils"),h=r(g),m=e("./lens"),P=r(m);n.Sonic=u,function(e){e.State=o["default"],e.AsyncIterator=f["default"],e.List=c.List,e.Tree=s["default"],e.Subject=p.Subject,e.Cache=v["default"],e.PromiseUtils=h["default"],e.Lens=P["default"]}(u||(n.Sonic=n.Sonic=u={})),t.exports=u,n["default"]=u},{"./async_iterator":1,"./cache":2,"./lens":4,"./list":5,"./observable":6,"./promise_utils":8,"./state":11,"./tree":12}],11:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,i=e("./key"),o=r(i),a=e("./range"),f=e("./cache"),c=r(f),l=e("./async_iterator"),s=r(l),d=e("./tree");n.State=u,function(e){function t(e,t){var n=t.get,r=t.prev,u=t.next,i=Object.create(e);return n&&(i.get=n),r&&(i.prev=r),u&&(i.next=u),i}function n(e){return e.next().then(function(t){return e.get(t)})}function r(e){return e.prev().then(function(t){return e.get(t)})}function u(e,t){return e.get(t).then(function(){return!0},function(e){return e===o["default"].NOT_FOUND_ERROR?!1:Promise.reject(e)})}function i(e,t){return s["default"].some(N(e),function(e,n){return e===t})}function f(e){return e.next().then(function(e){return e===o["default"].sentinel})}function l(e){var t=arguments.length<=1||void 0===arguments[1]?a.Range.all:arguments[1];return _(N(e,t))}function v(e,n,r){function i(e){return r.get(e)["catch"](function(t){return t===o["default"].NOT_FOUND_ERROR?p.get(e):Promise.reject(t)})}function f(){var e=arguments.length<=0||void 0===arguments[0]?o["default"].sentinel:arguments[0];return a.Position.isPrevPosition(m)&&e===m.prev?p.next(o["default"].sentinel):u(v,e).then(function(t){return t?v.prev(e):p.prev(e)})}function c(){var e=arguments.length<=0||void 0===arguments[0]?o["default"].sentinel:arguments[0];return a.Position.isNextPosition(g)&&e===g.next?v.next(o["default"].sentinel):u(v,e).then(function(t){return t?v.next(e):p.next(e)})}var s=l(e,n),d=h(e,function(e,t){return s.get(t).then(function(){return!1},function(){return!0})});if(null==r)return d;var v,p,g=n[0],m=n[1];return v=t(r,{prev:function(t){return r.prev(t).then(function(t){return t!==o["default"].sentinel?Promise.resolve(t):a.Position.isNextPosition(g)?Promise.resolve(g.next):e.prev(g.prev)})},next:function(t){return r.next(t).then(function(t){return t!==o["default"].sentinel?Promise.resolve(t):a.Position.isPrevPosition(m)?Promise.resolve(m.prev):e.next(m.next)})}}),p=t(d,{prev:function(t){return e.prev(t).then(function(e){return a.Position.isNextPosition(m)&&e===m.next?v.prev(o["default"].sentinel):u(s,e).then(function(t){return t?o["default"].NOT_FOUND:e})})},next:function(t){return e.next(t).then(function(e){return a.Position.isPrevPosition(g)&&e===g.prev?v.next(o["default"].sentinel):u(s,e).then(function(t){return t?o["default"].NOT_FOUND:e})})}}),{get:i,prev:f,next:c}}function p(e){return t(e,{prev:e.next,next:e.prev})}function g(e,n){return t(e,{get:function(t){return e.get(t).then(function(e){return n(e,t)})}})}function h(e,n){function r(t){return e.get(t).then(function(e){return Promise.resolve(n(e,t)).then(function(t){return t?e:o["default"].NOT_FOUND})})}function u(t){return e.prev(t).then(function(t){return null===t?null:e.get(t).then(function(e){return n(e,t)}).then(function(e){return e?t:u(t)})})}function i(t){return e.next(t).then(function(t){return null===t?null:e.get(t).then(function(e){return n(e,t)}).then(function(e){return e?t:i(t)})})}return t(e,{get:r,prev:u,next:i})}function m(e,n){var r=function(t){return null==t?e.get(n).then(function(){return n},function(e){return e===o["default"].NOT_FOUND_ERROR?null:Promise.reject(e)}):n===t?Promise.resolve(null):o["default"].NOT_FOUND};return t(e,{get:function(t){return t===n?e.get(n):o["default"].NOT_FOUND},prev:r,next:r})}function P(e){return t(e,{get:function(t){return d.Tree.get(e,d.Path.fromKey(t))},prev:function(t){return d.Tree.prev(e,d.Path.fromKey(t)).then(d.Path.toKey)},next:function(t){return d.Tree.next(e,d.Path.fromKey(t)).then(d.Path.toKey)}})}function x(e){return c["default"].apply(e,c["default"].create())}function b(n,r){var u=x(e.map(n,r)),i=x({get:function(t){return s["default"].keyOf(e.toIterator(u),t)},prev:function(e){return i.get(e).then(u.prev).then(u.get)},next:function(e){return i.get(e).then(u.next).then(u.get)}});return t(i,{get:function(e){return i.get(e).then(n.get)}})}function O(e){return{get:function(t){return t in e?Promise.resolve(e[t]):o["default"].NOT_FOUND},prev:function(t){var n=null==t?e.length-1:t-1;return Promise.resolve(-1===n?null:n)},next:function(t){var n=null==t?0:t+1;return Promise.resolve(n===e.length?null:n)}}}function y(e){var t=Object.keys(e),n=t.reduce(function(e,t,n){return e[t]=n,e},Object.create(null));return{get:function(t){return t in e?Promise.resolve(e[t]):o["default"].NOT_FOUND},prev:function(e){if(null==e)return Promise.resolve(t[t.length-1]);if(!(e in n))return o["default"].NOT_FOUND;var r=n[e];return 0===r?Promise.resolve(null):Promise.resolve(t[r-1])},next:function(e){if(null==e)return Promise.resolve(t[0]);if(!(e in n))return o["default"].NOT_FOUND;var r=n[e];return r===t.length-1?Promise.resolve(null):Promise.resolve(t[r+1])}}}function _(e){function t(e){return i?o["default"].NOT_FOUND:e===a?f.get():s["default"].find(f,function(t,n){return n===e})}function n(e){return i?o["default"].NOT_FOUND:s["default"].some(f,function(t,n){return n===e}).then(function(){return u.prev[e]})}function r(e){return i?o["default"].NOT_FOUND:e===a?f.next():s["default"].findKey(f,function(t,n){return n===e}).then(function(){return f.next()})}var u=c["default"].create(),i=!1,a=null,f=s["default"].extend(e,{get:function(){return u.get[a]=e.get()},next:function(){return u.next[a]=e.next().then(function(e){return u.prev[e]=Promise.resolve(a),i=null===e,a=e})}});return c["default"].apply({get:t,prev:n,next:r},u)}function N(e){function t(){return e.get(u)}function n(){function t(t){return e.next(t).then(function(e){return u=a.Position.isPrevPosition(i)&&i.prev===e?o["default"].sentinel:e})}var n=r[0],i=r[1];return a.Position.isPrevPosition(n)&&a.Position.isPrevPosition(i)&&n.prev===i.prev?Promise.resolve(o["default"].sentinel):a.Position.isNextPosition(n)&&a.Position.isNextPosition(i)&&n.next===i.next?Promise.resolve(o["default"].sentinel):u===o["default"].sentinel?a.Position.isPrevPosition(n)?Promise.resolve(u=n.prev):t(n.next):a.Position.isNextPosition(i)&&i.next===u?Promise.resolve(u=o["default"].sentinel):t(u)}var r=arguments.length<=1||void 0===arguments[1]?a.Range.all:arguments[1],u=o["default"].sentinel;return{get:t,next:n}}e.Empty={get:function(e){return o["default"].NOT_FOUND},prev:function(){var e=arguments.length<=0||void 0===arguments[0]?o["default"].sentinel:arguments[0];return e==o["default"].sentinel?Promise.resolve(o["default"].sentinel):o["default"].NOT_FOUND},next:function(){var e=arguments.length<=0||void 0===arguments[0]?o["default"].sentinel:arguments[0];return e==o["default"].sentinel?Promise.resolve(o["default"].sentinel):o["default"].NOT_FOUND}},e.extend=t,e.first=n,e.last=r,e.has=u,e.contains=i,e.isEmpty=f,e.slice=l,e.splice=v,e.reverse=p,e.map=g,e.filter=h,e.zoom=m,e.flatten=P,e.cache=x,e.keyBy=b,e.fromArray=O,e.fromObject=y,e.fromIterator=_,e.toIterator=N}(u||(n.State=u={})),n["default"]=u},{"./async_iterator":1,"./cache":2,"./key":3,"./range":9,"./tree":12}],12:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,i=e("./state"),o=r(i);n.Path=u,function(e){function t(e){return null==e?null:JSON.stringify(e)}function n(e){return null==e?null:JSON.parse(e.toString())}function r(e){return null==e?null:JSON.stringify(e)}function u(e){return e?e[0]:null}function i(e,t){return e?e[t]:null}function o(e){return null==e?[]:e.slice(1,e.length)}function a(e,t){return[].concat(e).concat(t)}e.key=t,e.fromKey=n,e.toKey=r,e.head=u,e.get=i,e.tail=o,e.append=a}(u||(n.Path=u={}));var a;n.Tree=a,function(e){function t(e,t){var n=u.get(t,0),r=u.get(t,1);return e.get(n).then(function(e){return e.get(r)})}function n(e,t){var n=u.get(t,0),r=u.get(t,1),i=o["default"].filter(o["default"].map(e,function(e){return e.prev()}),function(e){return null!=e}),a=o["default"].map(i,function(e,t){return[t,e]});return null==n?a.prev().then(function(e){return null!=e?a.get(e):null}):e.get(n).then(function(e){return e.prev(r)}).then(function(e){return null!=e?[n,e]:a.prev(n).then(function(e){return null!=e?a.get(e):null})})}function r(e,t){var n=u.get(t,0),r=u.get(t,1),i=o["default"].filter(o["default"].map(e,function(e){return e.next()}),function(e){return null!=e}),a=o["default"].map(i,function(e,t){return[t,e]});return null==n?a.next().then(function(e){return null!=e?a.get(e):null}):e.get(n).then(function(e){return e.next(r)}).then(function(e){return null!=e?[n,e]:a.next(n).then(function(e){return null!=e?a.get(e):null})})}e.get=t,e.prev=n,e.next=r}(a||(n.Tree=a={})),n["default"]=a},{"./state":11}]},{},[10])(10)});