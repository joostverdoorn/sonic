!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Sonic=e()}}(function(){return function e(t,n,r){function u(i,c){if(!n[i]){if(!t[i]){var f="function"==typeof require&&require;if(!c&&f)return f(i,!0);if(o)return o(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var s=n[i]={exports:{}};t[i][0].call(s.exports,function(e){var n=t[i][1][e];return u(n?n:e)},s,s.exports,e,t,n,r)}return n[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)u(r[i]);return u}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r;n.factory=r,function(e){function t(e){return{get:function(t){return t in e?Promise.resolve(e[t]):Promise.reject(new Error)},prev:function(t){var n=null==t?e.length-1:t-1;return Promise.resolve(-1==n?null:n)},next:function(t){var n=null==t?0:t+1;return Promise.resolve(n==e.length?null:n)}}}function n(e){var t=Object.keys(e),n={"null":-1};return{get:function(t){return t in e?Promise.resolve(e[t]):Promise.reject(new Error)},prev:function(r){var u=null==r?t.length-1:n[r]-1;return n[t[u]]=u,null==r?Promise.resolve(t[t.length-1]):r in e?Promise.resolve(-1==u?null:t[u]):Promise.reject(new Error)},next:function(r){var u=n[r]+1;return n[t[u]]=u,null==r?Promise.resolve(t[0]):r in e?Promise.resolve(u==t.length?null:t[u]):Promise.reject(new Error)}}}e.fromArray=t,e.fromObject=n}(r||(n.factory=r={})),n["default"]=r},{}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r;!function(e){function t(e){return e.toString()}function n(){return r++}var r=0;e.key=t,e.create=n}(r||(r={})),n["default"]=r,t.exports=n["default"]},{}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,o=e("./state"),i=r(o),c=e("./observable"),f=e("./patch");n.List=u,function(e){function t(e){function t(t,n,r){return{get:function(n){return t[n]==a?Promise.reject(new Error):void 0===t[n]?t[n]=e.state.get(n):t[n]},prev:function(t){return void 0===n[t]?e.state.prev(t).then(function(e){return r[e]=t,n[t]=e}):Promise.resolve(n[t])},next:function(t){return void 0===r[t]?e.state.next(t).then(function(e){return n[e]=t,r[t]=e}):Promise.resolve(r[t])}}}var n=new c.Subject,r={get:Object.create(null),prev:Object.create(null),next:Object.create(null)},u=Object.defineProperties({subscribe:n.subscribe},{state:{get:function(){return t(r.get,r.prev,r.next)},configurable:!0,enumerable:!0}});return e.subscribe({onNext:function(e){return Promise.resolve().then(function(){var t=u.state;return r={get:Object.create(r.get),prev:Object.create(r.prev),next:Object.create(r.next)},f.Patch.isSetPatch(e)&&(r.get[e.key]=Promise.resolve(e.value),void 0!==e.before)?t.prev(e.before).then(function(t){var n=e.before;r.prev[n]=e.key,r.next[e.key]=n,r.prev[e.key]=t,r.next[t]=e.key}):f.Patch.isDeletePatch(e)?(r.get[e.key]=a,t.prev(e.key).then(function(t){return u.state.next(e.key).then(function(e){return r.prev[e]=t,r.next[t]=e})})):void 0}).then(function(){return n.onNext(e)})}}),u}function n(e,t){var n={state:e,subscribe:t.subscribe};return t.subscribe({onNext:function(e){n.state=i["default"].patch(n.state,e)}}),n}function r(e,t){var r=i["default"].map(e.state,t),u=c.Observable.map(e,function(e){return f.Patch.isSetPatch(e)?Promise.resolve(t(e.value,e.key)).then(function(t){return{operation:f.Patch.SET,key:e.key,value:t,before:e.before}}):e});return n(r,u)}function u(e,t){var r=i["default"].filter(e.state,t),u=c.Observable.map(e,function(e){return f.Patch.isSetPatch(e)?Promise.resolve(t(e.value,e.key)).then(function(t){return t?e:{operation:f.Patch.DELETE,key:e.key}}):e});return n(r,u)}function o(e,t){var r=i["default"].zoom(e.state,t),u=c.Observable.filter(e,function(e){return e.key===t});return n(r,u)}var a=Promise.resolve({});e.cache=t,e.create=n,e.map=r,e.filter=u,e.zoom=o}(u||(n.List=u={})),n["default"]=u},{"./observable":4,"./patch":5,"./state":6}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){var t=!1;return{dispose:function(){t||(t=!0,e())}}}Object.defineProperty(n,"__esModule",{value:!0}),n.disposable=o;var i=e("./key"),c=r(i),f=function s(){var e=this;u(this,s),this._count=0,this.subscribe=function(t){var n=c["default"].create();return e._observers[n]=t,o(function(){return delete e._observers[n]})},this.onNext=function(t){return Promise.all(Object.keys(e._observers).map(function(n){return e._observers[n].onNext(t)})).then(function(){})},this._observers=Object.create(null)};n.Subject=f;var a;n.Observable=a,function(e){function t(e,t){var n=new f;return e.subscribe({onNext:function(e){return Promise.resolve(t(e)).then(n.onNext)}}),{subscribe:n.subscribe}}function n(e,t){var n=new f;return e.subscribe({onNext:function(e){return Promise.resolve(t(e)).then(function(t){return t?n.onNext(e):void 0})}}),{subscribe:n.subscribe}}e.map=t,e.filter=n}(a||(n.Observable=a={}))},{"./key":2}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r;n.Patch=r,function(e){function t(t){return t.operation===e.SET}function n(t){return t.operation===e.DELETE}e.SET="set",e.DELETE="delete",e.isSetPatch=t,e.isDeletePatch=n}(r||(n.Patch=r={})),n["default"]=r},{}],6:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,o=e("./state_iterator"),i=r(o),c=e("./patch");n.State=u,function(e){function t(e,t){var n=t.get,r=t.prev,u=t.next,o=Object.create(e);return n&&(o.get=n),r&&(o.prev=r),u&&(o.next=u),o}function n(e,n){var r=e;return c.Patch.isSetPatch(n)&&(r=t(r,u(r,n.key,n.value,n.before))),c.Patch.isDeletePatch(n)&&(r=t(r,o(r,n.key))),r}function r(e,t){return t.reduce(function(e,t){return n(e,t)},e)}function u(e,n,r,u){var o={get:function(t){return t===n?Promise.resolve(r):e.get(t)}};return void 0!==u&&(o.prev=function(){var t=void 0===arguments[0]?null:arguments[0];return t===u?Promise.resolve(n):e.prev(t==n?u:t)},o.next=function(){var t=void 0===arguments[0]?null:arguments[0];return t===n?Promise.resolve(u):e.next(t).then(function(e){return e==u?n:e})}),t(e,o)}function o(n,r){return t(n,{get:function(t){return t!==r?n.get(t):e.NOT_FOUND},prev:function(){var e=void 0===arguments[0]?null:arguments[0];return n.prev(e).then(function(e){return e===r?n.prev(e):e})},next:function(){var e=void 0===arguments[0]?null:arguments[0];return n.next(e).then(function(e){return e===r?n.next(e):e})}})}function f(e){return t(e,{prev:e.next,next:e.prev})}function a(e,n){return t(e,{get:function(t){return e.get(t).then(function(e){return n(e,t)})}})}function s(n,r){return t(n,{get:function(t){return n.get(t).then(function(t){return r(t)?t:e.NOT_FOUND})},prev:function(t){return i["default"].findKey(e.reverse(n),r,[t,null])},next:function(e){return i["default"].findKey(n,r,[e,null])}})}function l(n,r){var u=function(t){return null==t?Promise.resolve(r):t===r?Promise.resolve(null):e.NOT_FOUND};return t(n,{get:function(t){return t===r?n.get(r):e.NOT_FOUND},prev:u,next:u})}e.extend=t,e.patch=n,e.patches=r,e.set=u,e.del=o,e.reverse=f,e.map=a,e.filter=s,e.zoom=l}(u||(n.State=u={})),Object.defineProperty(u,"NOT_FOUND",{get:function(){return Promise.reject("No entry at the specified key")}}),n["default"]=u},{"./patch":5,"./state_iterator":7}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./state"),i=r(o),c=function f(e){var t=this,n=void 0===arguments[1]?[null,null]:arguments[1];u(this,f),this.get=function(){return t.state.get(t.current)},this.prev=function(){return t.state.prev(null==t.current?t.range[1]:t.current).then(function(e){return t.current=e==t.range[0]?null:e})},this.next=function(){return t.state.next(null==t.current?t.range[0]:t.current).then(function(e){return t.current=e==t.range[1]?null:e})},this.state=e,this.range=n};n.StateIterator=c,function(e){function t(e){var t=void 0===arguments[1]?[null,null]:arguments[1];return e.next(t[0]).then(e.get)}function n(e){var t=void 0===arguments[1]?[null,null]:arguments[1];return e.prev(t[1]).then(e.get)}function r(t,n,r){function u(){return o.next().then(function(e){return null==e||o.get().then(function(t){return n(t,e)}).then(function(e){return e?u():!1})})}var o=new e(t,r);return u()}function u(e,t,n){return r(e,function(e,n){return Promise.resolve(t(e,n)).then(function(e){return!e})},n).then(function(e){return!e})}function o(e,t,n){return r(e,function(e,n){return Promise.resolve(t(e,n)).then(function(){return!0})},n).then(function(){})}function c(e,t,n,r){return o(e,function(e,r){return Promise.resolve(t(n,e,r)).then(function(e){n=e})},r).then(function(){return n})}function f(e,t){return c(e,function(e,t){return e.push(t),e},[],t)}function a(e,t){return c(e,function(e,t,n){return e[n]=t,e},Object.create(null),t)}function s(e,t,n){var r;return u(e,function(e,n){return Promise.resolve(t(e,n)).then(function(e){return e?(r=n,!0):!1})},n).then(function(e){return e?r:null})}function l(e,t,n){return s(e,t,n).then(e.get)}function v(e,t,n){return s(e,function(e){return e===t},n)}function d(e,t,n){var r=-1;return u(e,function(e,n){return r++,t==e},n).then(function(e){return e?r:void i["default"].NOT_FOUND})}function h(e,t,n){return s(e,function(){return 0===t--},n)}function b(e,t,n){return h(e,t,n).then(e.get)}function p(e,t,n){return u(e,function(e){return e===t},n)}e.first=t,e.last=n,e.every=r,e.some=u,e.forEach=o,e.reduce=c,e.toArray=f,e.toObject=a,e.findKey=s,e.find=l,e.keyOf=v,e.indexOf=d,e.keyAt=h,e.at=b,e.contains=p}(c||(n.StateIterator=c={})),n["default"]=c},{"./state":6}],8:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e){}Object.defineProperty(n,"__esModule",{value:!0}),n.Sonic=u;var u,o=e("./patch"),i=r(o),c=e("./state"),f=r(c),a=e("./state_iterator"),s=r(a),l=e("./list"),v=r(l),d=e("./factory"),h=r(d),b=e("./observable");n.Sonic=u,function(e){e.Patch=i["default"],e.State=f["default"],e.StateIterator=s["default"],e.List=v["default"],e.factory=h["default"],e.Subject=b.Subject}(u||(n.Sonic=n.Sonic=u={})),t.exports=u,n["default"]=u},{"./factory":1,"./list":3,"./observable":4,"./patch":5,"./state":6,"./state_iterator":7}]},{},[8])(8)});