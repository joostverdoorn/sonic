!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Sonic=e()}}(function(){return function e(t,n,r){function u(i,a){if(!n[i]){if(!t[i]){var f="function"==typeof require&&require;if(!a&&f)return f(i,!0);if(o)return o(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[i]={exports:{}};t[i][0].call(l.exports,function(e){var n=t[i][1][e];return u(n?n:e)},l,l.exports,e,t,n,r)}return n[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)u(r[i]);return u}({1:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,o=e("./key"),i=r(o);n.AsyncIterator=u,function(e){function t(e,t){return e=Object.create(e),"get"in t&&(e.get=t.get),"next"in t&&(e.next=t.next),e}function n(e,t){function n(){return e.next().then(function(r){return null==r||e.get().then(function(e){return t(e,r)}).then(function(e){return e?n():!1})})}return n()}function r(e,t){return n(e,function(e,n){return Promise.resolve(t(e,n)).then(function(e){return!e})}).then(function(e){return!e})}function u(e,t){return n(e,function(e,n){return Promise.resolve(t(e,n)).then(function(){return!0})}).then(function(){})}function o(e,t,n){return u(e,function(e,r){return Promise.resolve(t(n,e,r)).then(function(e){n=e})}).then(function(){return n})}function a(e,t){var n;return r(e,function(e,r){return Promise.resolve(t(e,r)).then(function(e){return e?(n=r,!0):!1})}).then(function(e){return e?n:i["default"].NOT_FOUND})}function f(e,t){return a(e,t).then(e.get)}function c(e,t){return a(e,function(e){return e===t})}function l(e,t){var n=-1;return r(e,function(e,r){return n++,t==e}).then(function(e){return e?n:i["default"].NOT_FOUND})}function s(e,t){return a(e,function(){return 0===t--})}function d(e,t){return s(e,t).then(e.get)}function v(e,t){return r(e,function(e){return e===t})}function g(e){return o(e,function(e,t){return e.push(t),e},[])}function h(e){return o(e,function(e,t,n){return e[n]=t,e},Object.create(null))}e.extend=t,e.every=n,e.some=r,e.forEach=u,e.reduce=o,e.findKey=a,e.find=f,e.keyOf=c,e.indexOf=l,e.keyAt=s,e.at=d,e.contains=v,e.toArray=g,e.toObject=h}(u||(n.AsyncIterator=u={})),n["default"]=u},{"./key":3}],2:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,o=e("./key"),i=r(o);n.Cache=u,function(e){function t(){return{get:Object.create(null),prev:Object.create(null),next:Object.create(null)}}function n(e){return{get:Object.create(e.get),prev:Object.create(e.prev),next:Object.create(e.next)}}function r(e,t){function n(n){return n in e.get?e.get[n]:e.get[n]=t.get(n)}function r(){var n=void 0===arguments[0]?i["default"].None:arguments[0];return n in e.prev?e.prev[n]:e.prev[n]=t.prev(n).then(function(t){return e.next[t]=Promise.resolve(n),t})}function u(){var n=void 0===arguments[0]?i["default"].None:arguments[0];return n in e.next?e.next[n]:e.next[n]=t.next(n).then(function(t){return e.prev[t]=Promise.resolve(n),t})}return{get:n,prev:r,next:u}}e.create=t,e.extend=n,e.apply=r}(u||(n.Cache=u={})),n["default"]=u},{"./key":3}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,o=e("./promise_utils"),i=r(o);!function(e){function t(e){return e.toString()}function n(){return r++}e.NOT_FOUND_ERROR=new Error("No entry at the specified key"),e.NOT_FOUND=i["default"].lazy(function(t,n){return n(e.NOT_FOUND_ERROR)}),e.None=null;var r=0;e.key=t,e.create=n}(u||(u={})),n["default"]=u,t.exports=n["default"]},{"./promise_utils":8}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,o=e("./key"),i=r(o),a=e("./patch"),f=r(a),c=e("./state"),l=r(c),s=e("./cache"),d=r(s),v=e("./range"),g=r(v),h=e("./tree"),p=e("./observable"),b=e("./async_iterator"),m=r(b);n.List=u,function(e){function t(e,t){var n=l["default"].map(e.state,t),r=p.Observable.map(e.patches,function(e){return{range:e.range,added:e.added?l["default"].map(e.added,t):void 0}});return c(n,r)}function n(e,t){function n(e,t){return r=f["default"].apply(t,e)}var r=l["default"].filter(e.state,t),u=p.Observable.map(e.patches,function(e){return Promise.all([null==e.range[0]?Promise.resolve(null):r.get(e.range[0]).then(function(t){return e.range[0]})["catch"](function(t){return t===i["default"].NOT_FOUND_ERROR?r.prev(e.range[0]):Promise.reject(t)}),null==e.range[1]?Promise.resolve(null):r.get(e.range[1]).then(function(t){return e.range[1]})["catch"](function(t){return t===i["default"].NOT_FOUND_ERROR?r.next(e.range[1]):Promise.reject(t)})]).then(function(n){return{range:n,added:e.added?l["default"].filter(e.added,t):void 0}})});return c(r,u,n)}function r(e,t){var n=l["default"].zoom(e.state,t),r=p.Observable.map(p.Observable.filter(e.patches,function(n){return m["default"].some(l["default"].toIterator(e.state,n.range),function(e,n){return n===t})}),function(e){return{range:g["default"].all,added:e.added?l["default"].zoom(e.added,t):void 0}});return c(n,r)}function u(e){var n=new p.Subject,r=a(t(e,function(e,t){return p.Observable.map(e.patches,function(e){return Promise.all([null==e.range[0]?h.Tree.prev(r.state,[t]).then(h.Path.toKey):h.Path.toKey(h.Path.append([t],e.range[0])),null==e.range[1]?h.Tree.next(r.state,[t]).then(h.Path.toKey):h.Path.toKey(h.Path.append([t],e.range[1]))]).then(function(t){return{range:t,added:e.added?e.added:void 0}})}).subscribe(n),e.state})),u=l["default"].flatten(r.state);return c(u,n)}function o(e,t){var n=l["default"].keyBy(e.state,t),r=e.state,u=p.Observable.map(e.patches,function(n){return r=e.state,Promise.all([n.range[0]==i["default"].None?Promise.resolve(i["default"].None):r.get(n.range[0]).then(function(e){return t(e,n.range[0])}),n.range[1]==i["default"].None?Promise.resolve(i["default"].None):r.get(n.range[1]).then(function(e){return t(e,n.range[1])})]).then(function(e){return{range:e,added:n.added?l["default"].keyBy(n.added,t):void 0}})});return c(n,u)}function a(t){var n=d["default"].create(),r=d["default"].apply(n,t.state);return e.create(r,t.patches)}function c(e,t){var n=void 0===arguments[2]?l["default"].patch:arguments[2],r={state:e,patches:t};return p.Observable.scan(t,n,e).subscribe({onNext:function(e){r.state=e}}),r}e.map=t,e.filter=n,e.zoom=r,e.flatten=u,e.keyBy=o,e.cache=a,e.create=c}(u||(n.List=u={})),n["default"]=u},{"./async_iterator":1,"./cache":2,"./key":3,"./observable":6,"./patch":7,"./range":9,"./state":10,"./tree":11}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,o=e("./state"),i=r(o),a=e("./observable");n.Mutable=u,function(e){function t(e,t){var n=void 0===arguments[2]?i["default"].patch:arguments[2],r={state:e,patches:t};return a.Observable.scan(t,n,e).subscribe({onNext:function(e){r.state=e}}),r}e.create=t}(u||(n.Mutable=u={})),n["default"]=u},{"./observable":6,"./state":10}],6:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){var t=!1;return{dispose:function(){t||(t=!0,e())}}}Object.defineProperty(n,"__esModule",{value:!0}),n.disposable=o;var i=e("./key"),a=r(i),f=function l(){var e=this;u(this,l),this._count=0,this.subscribe=function(t){var n=a["default"].create();return e._observers[n]=t,o(function(){return delete e._observers[n]})},this.onNext=function(t){return Promise.all(Object.keys(e._observers).map(function(n){return e._observers[n].onNext(t)})).then(function(){})},this._observers=Object.create(null)};n.Subject=f;var c;n.Observable=c,function(e){function t(e,t){var n=new f;return e.subscribe({onNext:function(e){return Promise.resolve(t(e)).then(n.onNext)}}),{subscribe:n.subscribe}}function n(e,t){var n=new f;return e.subscribe({onNext:function(e){return Promise.resolve(t(e)).then(function(t){return t?n.onNext(e):void 0})}}),{subscribe:n.subscribe}}function r(e,t,n){var r=new f;return e.subscribe({onNext:function(e){return Promise.resolve(t(n,e)).then(function(e){n=e,r.onNext(e)})}}),{subscribe:r.subscribe}}e.map=t,e.filter=n,e.scan=r}(c||(n.Observable=c={}))},{"./key":3}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,o=e("./state"),i=r(o);n.Patch=u,function(e){function t(e,t){return i["default"].splice(t,e.range,e.added)}e.apply=t}(u||(n.Patch=u={})),n["default"]=u},{"./state":10}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r;n.PromiseUtils=r,function(e){function t(e){function t(t,r){return n?n.then(t,r):(n=new Promise(e)).then(t,r)}var n;return Promise.resolve({then:t})}e.lazy=t}(r||(n.PromiseUtils=r={})),n["default"]=r},{}],9:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,o=e("./key"),i=r(o);n.Range=u,function(e){function t(e){return[e,i["default"].None]}function n(e){return[i["default"].None,e]}function r(e,t){return[e,t]}e.all=[i["default"].None,i["default"].None],e.from=t,e.to=n,e.between=r}(u||(n.Range=u={})),n["default"]=u},{"./key":3}],10:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,o=e("./key"),i=r(o),a=e("./range"),f=r(a),c=e("./cache"),l=r(c),s=e("./async_iterator"),d=r(s),v=e("./tree");n.State=u,function(e){function t(e){return e.next().then(function(t){return e.get(t)})}function n(e){return e.prev().then(function(t){return e.get(t)})}function r(e,t){var n=t.get,r=t.prev,u=t.next,o=Object.create(e);return n&&(o.get=n),r&&(o.prev=r),u&&(o.next=u),o}function u(e){var t=void 0===arguments[1]?[null,null]:arguments[1];return N(c(e,t))}function o(t,n){function r(e){return f.get(e)["catch"](function(t){return t===i["default"].NOT_FOUND_ERROR?l.get(e):Promise.reject(t)})}function o(){var e=void 0===arguments[0]?null:arguments[0];return e==n[0]?f.prev():null==e?l.prev():f.prev(e).then(function(e){return null==e?n[1]:e},function(t){return t===i["default"].NOT_FOUND_ERROR?l.next(e):Promise.reject(t)})}function a(){var e=void 0===arguments[0]?null:arguments[0];return e==n[0]?f.next():null==e?l.next():f.next(e).then(function(e){return null==e?n[1]:e},function(t){return t===i["default"].NOT_FOUND_ERROR?l.next(e):Promise.reject(t)})}var f=void 0===arguments[2]?e.Empty:arguments[2];if(n[0]===n[1]&&null!=n[0])return t;var c=u(t,n),l=h(t,function(e,t){return c.get(t).then(function(){return!1},function(){return!0})});return f===e.Empty?l:{get:r,prev:o,next:a}}function a(e,t){return o(e,t.range,t.added)}function c(e){function t(){return e.get(u)}function n(){return e.next(null===u?r[0]:u).then(function(e){return u=e==r[1]?null:e})}var r=void 0===arguments[1]?f["default"].all:arguments[1],u=null;return{get:t,next:n}}function s(e){return r(e,{prev:e.next,next:e.prev})}function g(e,t){return r(e,{get:function(n){return e.get(n).then(function(e){return t(e,n)})}})}function h(e,t){function n(n){return e.get(n).then(function(e){return Promise.resolve(t(e,n)).then(function(t){return t?e:i["default"].NOT_FOUND})})}function u(n){return e.prev(n).then(function(n){return null===n?null:e.get(n).then(function(e){return t(e,n)}).then(function(e){return e?n:u(n)})})}function o(n){return e.next(n).then(function(n){return null===n?null:e.get(n).then(function(e){return t(e,n)}).then(function(e){return e?n:o(n)})})}return r(e,{get:n,prev:u,next:o})}function p(e,t){var n=function(n){return null==n?e.get(t).then(function(){return t},function(e){return e===i["default"].NOT_FOUND_ERROR?null:Promise.reject(e)}):t===n?Promise.resolve(null):i["default"].NOT_FOUND};return r(e,{get:function(n){return n===t?e.get(t):i["default"].NOT_FOUND},prev:n,next:n})}function b(e){return r(e,{get:function(t){return v.Tree.get(e,v.Path.fromKey(t))},prev:function(t){return v.Tree.prev(e,v.Path.fromKey(t)).then(v.Path.toKey)},next:function(t){return v.Tree.next(e,v.Path.fromKey(t)).then(v.Path.toKey)}})}function m(e){return l["default"].apply(l["default"].create(),e)}function O(t,n){var u=m(e.map(t,n)),o=m({get:function(t){return d["default"].keyOf(e.toIterator(u),t)},prev:function(e){return o.get(e).then(u.prev).then(u.get)},next:function(e){return o.get(e).then(u.next).then(u.get)}});return r(o,{get:function(e){return o.get(e).then(t.get)}})}function _(e){return{get:function(t){return t in e?Promise.resolve(e[t]):i["default"].NOT_FOUND},prev:function(t){var n=null==t?e.length-1:t-1;return Promise.resolve(-1===n?null:n)},next:function(t){var n=null==t?0:t+1;return Promise.resolve(n===e.length?null:n)}}}function y(e){var t=Object.keys(e),n=t.reduce(function(e,t,n){return e[t]=n,e},Object.create(null));return{get:function(t){return t in e?Promise.resolve(e[t]):i["default"].NOT_FOUND},prev:function(e){if(null==e)return Promise.resolve(t[t.length-1]);if(!(e in n))return i["default"].NOT_FOUND;var r=n[e];return Promise.resolve(0===r?null:t[r-1])},next:function(e){if(null==e)return Promise.resolve(t[0]);if(!(e in n))return i["default"].NOT_FOUND;var r=n[e];return Promise.resolve(r===t.length-1?null:t[r+1])}}}function N(e){function t(e){return o?i["default"].NOT_FOUND:e===a?f.get():d["default"].find(f,function(t,n){return n===e})}function n(e){return o?i["default"].NOT_FOUND:d["default"].some(f,function(t,n){return n===e}).then(function(){return u.prev[e]})}function r(e){return o?i["default"].NOT_FOUND:e===a?f.next():d["default"].findKey(f,function(t,n){return n===e}).then(function(){return f.next()})}var u=l["default"].create(),o=!1,a=null,f=d["default"].extend(e,{get:function(){return u.get[a]=e.get()},next:function(){return u.next[a]=e.next().then(function(e){return u.prev[e]=Promise.resolve(a),o=null===e,a=e})}});return l["default"].apply(u,{get:t,prev:n,next:r})}e.Empty={get:function(e){return i["default"].NOT_FOUND},prev:function(e){return null==e?Promise.resolve(i["default"].None):i["default"].NOT_FOUND},next:function(e){return null==e?Promise.resolve(i["default"].None):i["default"].NOT_FOUND}},e.first=t,e.last=n,e.extend=r,e.slice=u,e.splice=o,e.patch=a,e.toIterator=c,e.reverse=s,e.map=g,e.filter=h,e.zoom=p,e.flatten=b,e.cache=m,e.keyBy=O,e.fromArray=_,e.fromObject=y,e.fromIterator=N}(u||(n.State=u={})),n["default"]=u},{"./async_iterator":1,"./cache":2,"./key":3,"./range":9,"./tree":11}],11:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,o=e("./state"),i=r(o);n.Path=u,function(e){function t(e){return null==e?null:JSON.stringify(e)}function n(e){return null==e?null:JSON.parse(e.toString())}function r(e){return null==e?null:JSON.stringify(e)}function u(e){return e?e[0]:null}function o(e,t){return e?e[t]:null}function i(e){return null==e?[]:e.slice(1,e.length)}function a(e,t){return[].concat(e).concat(t)}e.key=t,e.fromKey=n,e.toKey=r,e.head=u,e.get=o,e.tail=i,e.append=a}(u||(n.Path=u={}));var a;n.Tree=a,function(e){function t(e,t){var n=u.get(t,0),r=u.get(t,1);return e.get(n).then(function(e){return e.get(r)})}function n(e,t){var n=u.get(t,0),r=u.get(t,1),o=i["default"].filter(i["default"].map(e,function(e){return e.prev()}),function(e){return null!=e}),a=i["default"].map(o,function(e,t){return[t,e]});return null==n?a.prev().then(function(e){return null!=e?a.get(e):null}):e.get(n).then(function(e){return e.prev(r)}).then(function(e){return null!=e?[n,e]:a.prev(n).then(function(e){return null!=e?a.get(e):null})})}function r(e,t){var n=u.get(t,0),r=u.get(t,1),o=i["default"].filter(i["default"].map(e,function(e){return e.next()}),function(e){return null!=e}),a=i["default"].map(o,function(e,t){return[t,e]});return null==n?a.next().then(function(e){return null!=e?a.get(e):null}):e.get(n).then(function(e){return e.next(r)}).then(function(e){return null!=e?[n,e]:a.next(n).then(function(e){return null!=e?a.get(e):null})})}e.get=t,e.prev=n,e.next=r}(a||(n.Tree=a={})),n["default"]=a},{"./state":10}],12:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e){return e instanceof Array?b["default"].create(i["default"].fromArray(e),new h.Subject):e instanceof Object?b["default"].create(i["default"].fromObject(e),new h.Subject):void 0}Object.defineProperty(n,"__esModule",{value:!0}),n.Sonic=u;var u,o=e("./state"),i=r(o),a=e("./async_iterator"),f=r(a),c=e("./list"),l=r(c),s=e("./tree"),d=r(s),v=e("./cache"),g=r(v),h=e("./observable"),p=e("./mutable"),b=r(p),m=e("./promise_utils"),O=r(m);n.Sonic=u,function(e){e.State=i["default"],e.AsyncIterator=f["default"],e.List=l["default"],e.Tree=d["default"],e.Subject=h.Subject,e.Mutable=b["default"],e.Cache=g["default"],e.PromiseUtils=O["default"]}(u||(n.Sonic=n.Sonic=u={})),t.exports=u,n["default"]=u},{"./async_iterator":1,"./cache":2,"./list":4,"./mutable":5,"./observable":6,"./promise_utils":8,"./state":10,"./tree":11}]},{},[12])(12)});