!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Sonic=e()}}(function(){return function e(t,n,r){function u(i,c){if(!n[i]){if(!t[i]){var a="function"==typeof require&&require;if(!c&&a)return a(i,!0);if(o)return o(i,!0);var f=new Error("Cannot find module '"+i+"'");throw f.code="MODULE_NOT_FOUND",f}var s=n[i]={exports:{}};t[i][0].call(s.exports,function(e){var n=t[i][1][e];return u(n?n:e)},s,s.exports,e,t,n,r)}return n[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)u(r[i]);return u}({1:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,o=e("./state"),i=r(o),c=e("./patch"),a=r(c);n.Cache=u,function(e){function t(){return{get:Object.create(null),prev:Object.create(null),next:Object.create(null)}}function n(e){return{get:Object.create(e.get),prev:Object.create(e.prev),next:Object.create(e.next)}}function r(t,r){if(t=n(t),a["default"].isSetPatch(r)){t.get[r.key]=r.value;var u=r.before;if(void 0!==u){var o=t.prev[u];void 0!==o&&(t.prev[r.key]=o,t.next[o]=r.key),t.prev[u]=r.key,t.next[r.key]=u}}if(a["default"].isDeletePatch(r)){var u=t.next[r.key],o=t.prev[r.key];void 0!==o&&(t.next[o]=u),void 0!==u&&(t.prev[u]=o),t.get[r.key]=e.DELETED,t.prev[r.key]=e.DELETED,t.next[r.key]=e.DELETED}return t}function u(t,n){function r(r){return t.get[r]===e.DELETED?i["default"].NOT_FOUND:r in t.get?Promise.resolve(t.get[r]):n.get(r).then(function(e){return t.get[r]=e})}function u(r){return t.prev[r]===e.DELETED?i["default"].NOT_FOUND:r in t.prev?Promise.resolve(t.prev[r]):n.prev(r).then(function(e){return t.prev[t.next[e]=r]=e})}function o(r){return t.next[r]===e.DELETED?i["default"].NOT_FOUND:r in t.next?Promise.resolve(t.next[r]):n.next(r).then(function(e){return t.next[t.prev[e]=r]=e})}return{get:r,prev:u,next:o}}e.DELETED={},e.create=t,e.extend=n,e.patch=r,e.apply=u}(u||(n.Cache=u={})),n["default"]=u},{"./patch":6,"./state":8}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r;!function(e){function t(e){return e.toString()}function n(){return r++}var r=0;e.key=t,e.create=n}(r||(r={})),n["default"]=r,t.exports=n["default"]},{}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,o=e("./patch"),i=r(o),c=e("./state"),a=r(c),f=e("./cache"),s=r(f),l=e("./observable");n.List=u,function(e){function t(e,t){var n=a["default"].map(e.state,t),r=l.Observable.map(e.patches,function(e){return i["default"].isSetPatch(e)?Promise.resolve(t(e.value,e.key)).then(function(t){return i["default"].setPatch(e.key,t,e.before)}):e});return o(n,r)}function n(e,t){var n=a["default"].filter(e.state,t),r=l.Observable.map(e.patches,function(e){return i["default"].isSetPatch(e)?Promise.resolve(t(e.value,e.key)).then(function(t){return t?e:i["default"].deletePatch(e.key)}):e});return o(n,r)}function r(e,t){var n=a["default"].zoom(e.state,t),r=l.Observable.filter(e.patches,function(e){return e.key===t});return o(n,r)}function u(t){var n=s["default"].create(),r=s["default"].apply(n,t.state),u=function(e,r){return n=s["default"].patch(n,r),s["default"].apply(n,t.state)};return e.create(r,t.patches,u)}function o(e,t){var n=arguments.length<=2||void 0===arguments[2]?a["default"].patch:arguments[2],r={state:e,patches:t};return l.Observable.scan(t,n,e).subscribe({onNext:function(e){r.state=e}}),r}e.map=t,e.filter=n,e.zoom=r,e.cache=u,e.create=o}(u||(n.List=u={})),n["default"]=u},{"./cache":1,"./observable":5,"./patch":6,"./state":8}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,o=e("./state"),i=r(o),c=e("./observable");n.Mutable=u,function(e){function t(e,t){var n=arguments.length<=2||void 0===arguments[2]?i["default"].patch:arguments[2],r={state:e,patches:t};return c.Observable.scan(t,n,e).subscribe({onNext:function(e){r.state=e}}),r}e.create=t}(u||(n.Mutable=u={})),n["default"]=u},{"./observable":5,"./state":8}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){var t=!1;return{dispose:function(){t||(t=!0,e())}}}Object.defineProperty(n,"__esModule",{value:!0}),n.disposable=o;var i=e("./key"),c=r(i),a=function s(){var e=this;u(this,s),this._count=0,this.subscribe=function(t){var n=c["default"].create();return e._observers[n]=t,o(function(){return delete e._observers[n]})},this.onNext=function(t){return Promise.all(Object.keys(e._observers).map(function(n){return e._observers[n].onNext(t)})).then(function(){})},this._observers=Object.create(null)};n.Subject=a;var f;n.Observable=f,function(e){function t(e,t){var n=new a;return e.subscribe({onNext:function(e){return Promise.resolve(t(e)).then(n.onNext)}}),{subscribe:n.subscribe}}function n(e,t){var n=new a;return e.subscribe({onNext:function(e){return Promise.resolve(t(e)).then(function(t){return t?n.onNext(e):void 0})}}),{subscribe:n.subscribe}}function r(e,t,n){var r=new a;return e.subscribe({onNext:function(e){return Promise.resolve(t(n,e)).then(function(e){n=e,r.onNext(e)})}}),{subscribe:r.subscribe}}e.map=t,e.filter=n,e.scan=r}(f||(n.Observable=f={}))},{"./key":2}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r;n.Patch=r,function(e){function t(t,n,r){return{operation:e.SET,key:t,value:n,before:r}}function n(t){return{operation:e.DELETE,key:t}}function r(t){return t.operation===e.SET}function u(t){return t.operation===e.DELETE}e.SET="set",e.DELETE="delete",e.setPatch=t,e.deletePatch=n,e.isSetPatch=r,e.isDeletePatch=u}(r||(n.Patch=r={})),n["default"]=r},{}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e){return e instanceof Array?g["default"].create(a["default"].fromArray(e),new p.Subject):e instanceof Object?g["default"].create(a["default"].fromObject(e),new p.Subject):void 0}Object.defineProperty(n,"__esModule",{value:!0}),n.Sonic=u;var u,o=e("./patch"),i=r(o),c=e("./state"),a=r(c),f=e("./state_iterator"),s=r(f),l=e("./list"),v=r(l),d=e("./cache"),h=r(d),p=e("./observable"),b=e("./mutable"),g=r(b);n.Sonic=u,function(e){e.Patch=i["default"],e.State=a["default"],e.StateIterator=s["default"],e.List=v["default"],e.Subject=p.Subject,e.Mutable=g["default"],e.Cache=h["default"]}(u||(n.Sonic=n.Sonic=u={})),t.exports=u,n["default"]=u},{"./cache":1,"./list":3,"./mutable":4,"./observable":5,"./patch":6,"./state":8,"./state_iterator":9}],8:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,o=e("./patch"),i=r(o),c=e("./cache"),a=r(c),f=e("./state_iterator"),s=r(f);n.State=u,function(e){function t(e,t){var n=t.get,r=t.prev,u=t.next,o=Object.create(e);return n&&(o.get=n),r&&(o.prev=r),u&&(o.next=u),o}function n(n,r){var u;return i["default"].isSetPatch(r)&&(u={get:function(e){return e===r.key?Promise.resolve(r.value):n.get(e)}},void 0!==r.before&&(u.prev=function(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];return e===r.before?Promise.resolve(e):e===r.key?n.prev(r.before):n.prev(e)},u.next=function(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];return e===r.key?Promise.resolve(r.before):n.next(e).then(function(e){return e==r.before?r.key:e})})),i["default"].isDeletePatch(r)&&(u={get:function(t){return t!==r.key?n.get(t):e.NOT_FOUND},prev:function(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];return n.prev(e).then(function(e){return e===r.key?n.prev(e):e})},next:function(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];return n.next(e).then(function(e){return e===r.key?n.next(e):e})}}),t(n,u)}function r(e){return t(e,{prev:e.next,next:e.prev})}function u(e,n){return t(e,{get:function(t){return e.get(t).then(function(e){return n(e,t)})}})}function o(n,r){return t(n,{get:function(t){return n.get(t).then(function(t){return r(t)?t:e.NOT_FOUND})},prev:function(t){return s["default"].findKey(e.reverse(n),r,[t,null])},next:function(e){return s["default"].findKey(n,r,[e,null])}})}function c(n,r){var u=function(t){return null==t?Promise.resolve(r):t===r?Promise.resolve(null):e.NOT_FOUND};return t(n,{get:function(t){return t===r?n.get(r):e.NOT_FOUND},prev:u,next:u})}function f(e){return a["default"].apply(a["default"].create(),e)}function l(n,r){var u=f(e.map(n,r)),o=f({get:function(e){return s["default"].keyOf(u,e)},prev:function(e){return o.get(e).then(u.prev).then(u.get)},next:function(e){return o.get(e).then(u.next).then(u.get)}});return t(o,{get:function(e){return o.get(e).then(n.get)}})}function v(e){return{get:function(t){return t in e?Promise.resolve(e[t]):Promise.reject(new Error)},prev:function(t){var n=null==t?e.length-1:t-1;return Promise.resolve(-1===n?null:n)},next:function(t){var n=null==t?0:t+1;return Promise.resolve(n===e.length?null:n)}}}function d(t){var n=Object.keys(t),r=n.reduce(function(e,t,n){return e[t]=n,e},Object.create(null));return{get:function(e){return e in t?Promise.resolve(t[e]):Promise.reject(new Error)},prev:function(t){if(null==t)return Promise.resolve(n[n.length-1]);if(!(t in r))return e.NOT_FOUND;var u=r[t];return 0===u?Promise.resolve(null):Promise.resolve(n[u-1])},next:function(t){if(null==t)return Promise.resolve(n[0]);if(!(t in r))return e.NOT_FOUND;var u=r[t];return u===n.length-1?Promise.resolve(null):Promise.resolve(n[u+1])}}}e.extend=t,e.patch=n,e.reverse=r,e.map=u,e.filter=o,e.zoom=c,e.cache=f,e.keyBy=l,e.fromArray=v,e.fromObject=d}(u||(n.State=u={})),Object.defineProperty(u,"NOT_FOUND",{get:function(){return Promise.reject("No entry at the specified key")}}),n["default"]=u},{"./cache":1,"./patch":6,"./state_iterator":9}],9:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./state"),i=r(o),c=function a(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?[null,null]:arguments[1];u(this,a),this.get=function(){return t.state.get(t.current)},this.prev=function(){return t.state.prev(null==t.current?t.range[1]:t.current).then(function(e){return e==t.range[0]?t.current=null:t.current=e})},this.next=function(){return t.state.next(null==t.current?t.range[0]:t.current).then(function(e){return e==t.range[1]?t.current=null:t.current=e})},this.state=e,this.range=n};n.StateIterator=c,function(e){function t(e){var t=arguments.length<=1||void 0===arguments[1]?[null,null]:arguments[1];return e.next(t[0]).then(e.get)}function n(e){var t=arguments.length<=1||void 0===arguments[1]?[null,null]:arguments[1];return e.prev(t[1]).then(e.get)}function r(t,n,r){function u(){return o.next().then(function(e){return null==e||o.get().then(function(t){return n(t,e)}).then(function(e){return e?u():!1})})}var o=new e(t,r);return u()}function u(e,t,n){return r(e,function(e,n){return Promise.resolve(t(e,n)).then(function(e){return!e})},n).then(function(e){return!e})}function o(e,t,n){return r(e,function(e,n){return Promise.resolve(t(e,n)).then(function(){return!0})},n).then(function(){})}function c(e,t,n,r){return o(e,function(e,r){return Promise.resolve(t(n,e,r)).then(function(e){n=e})},r).then(function(){return n})}function a(e,t){return c(e,function(e,t){return e.push(t),e},[],t)}function f(e,t){return c(e,function(e,t,n){return e[n]=t,e},Object.create(null),t)}function s(e,t,n){var r;return u(e,function(e,n){return Promise.resolve(t(e,n)).then(function(e){return e?(r=n,!0):!1})},n).then(function(e){return e?r:null})}function l(e,t,n){return s(e,t,n).then(e.get)}function v(e,t,n){return s(e,function(e){return e===t},n)}function d(e,t,n){var r=-1;return u(e,function(e,n){return r++,t==e},n).then(function(e){return e?r:void i["default"].NOT_FOUND})}function h(e,t,n){return s(e,function(){return 0===t--},n)}function p(e,t,n){return h(e,t,n).then(e.get)}function b(e,t,n){return u(e,function(e){return e===t},n)}e.first=t,e.last=n,e.every=r,e.some=u,e.forEach=o,e.reduce=c,e.toArray=a,e.toObject=f,e.findKey=s,e.find=l,e.keyOf=v,e.indexOf=d,e.keyAt=h,e.at=p,e.contains=b}(c||(n.StateIterator=c={})),n["default"]=c},{"./state":8}]},{},[7])(7)});