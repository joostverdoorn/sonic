!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Sonic=e()}}(function(){return function e(t,n,r){function u(i,l){if(!n[i]){if(!t[i]){var a="function"==typeof require&&require;if(!l&&a)return a(i,!0);if(o)return o(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var s=n[i]={exports:{}};t[i][0].call(s.exports,function(e){var n=t[i][1][e];return u(n?n:e)},s,s.exports,e,t,n,r)}return n[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)u(r[i]);return u}({1:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e,t,n){for(var r=!0;r;){var u=e,o=t,i=n;l=c=a=void 0,r=!1,null===u&&(u=Function.prototype);var l=Object.getOwnPropertyDescriptor(u,o);if(void 0!==l){if("value"in l)return l.value;var a=l.get;return void 0===a?void 0:a.call(i)}var c=Object.getPrototypeOf(u);if(null===c)return void 0;e=c,t=o,n=i,r=!0}},l=e("./observable_list"),a=e("./mutable_list"),c=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];r(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this._subject=new l.ListSubject,this._array=e}return u(t,e),o(t,[{key:"get",value:function(e){return null!=e&&e>=0&&e<this._array.length?Promise.resolve(this._array[e]):Promise.reject(new Error)}},{key:"prev",value:function(e){return null==e?Promise.resolve(this._array.length?this._array.length-1:null):0==e?Promise.resolve(null):e-1>=0&&e<this._array.length?Promise.resolve(e-1):void Promise.reject(new Error)}},{key:"next",value:function(e){return null==e?Promise.resolve(this._array.length?0:null):e==this._array.length-1?Promise.resolve(null):e>=0&&e+1<this._array.length?Promise.resolve(e+1):void Promise.reject(new Error)}},{key:"set",value:function(e,t){return this.splice(e>0?e-1:null,e<this._array.length-1?e+1:null,t)}},{key:"splice",value:function(e,t){var n;if(null!=e&&(0>e||e>=this._array.length))return Promise.reject(new Error);if(null!=e&&(0>t||t>=this._array.length))return Promise.reject(new Error);for(var r=arguments.length,u=Array(r>2?r-2:0),o=2;r>o;o++)u[o-2]=arguments[o];return(n=this._array).splice.apply(n,[null==e?0:e+1,(null==t?this._array.length:t)-(null==e?0:e+1)].concat(u)),this._subject.onInvalidate([e,null]),Promise.resolve()}},{key:"observe",value:function(e){return this._subject.observe(e)}}]),t}(a.MutableList);n["default"]=c,t.exports=n["default"]},{"./mutable_list":11,"./observable_list":15}],2:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("./bind"),l=r(i),a=function(){function e(t){var n=arguments.length<=1||void 0===arguments[1]?[null,null]:arguments[1];u(this,e),this._list=t,this.range=n}return o(e,[{key:"get",value:function(){return this._list.get(this.current)}},{key:"prev",value:function(){var e=this;return this._list.prev(null==this.current?this.range[1]:this.current).then(function(t){return t==e.range[0]?e.current=null:e.current=t})}},{key:"next",value:function(){var e=this;return this._list.next(null==this.current?this.range[0]:this.current).then(function(t){return t==e.range[1]?e.current=null:e.current=t})}}],[{key:"every",value:function(t,n){return t.next().then(function(r){return null==r||t.get().then(function(e){return n(e,r)}).then(function(r){return r?e.every(t,n):!1})})}},{key:"some",value:function(t,n){return e.every(t,function(e,t){return Promise.resolve(n(e,t)).then(function(e){return!e})}).then(function(e){return!e})}},{key:"forEach",value:function(t,n){return e.every(t,function(e,t){return Promise.resolve(n(e,t)).then(function(){return!0})}).then(function(){})}},{key:"reduce",value:function(t,n,r){return e.forEach(t,function(e,t){return Promise.resolve(n(r,e,t)).then(function(e){r=e})}).then(function(){return r})}},{key:"toArray",value:function(t){return e.reduce(t,function(e,t){return e.push(t),e},[])}},{key:"findKey",value:function(t,n){var r;return e.some(t,function(e,t){return Promise.resolve(n(e,t)).then(function(e){return e?!!(r=t)||!0:!1})}).then(function(e){return e?r:null})}},{key:"find",value:function(t,n){return e.findKey(t,n).then(l["default"](t.get,t))}},{key:"keyOf",value:function(t,n){return e.findKey(t,function(e){return e===n})}},{key:"indexOf",value:function(t,n){var r=-1;return e.some(t,function(e,t){return r++,n==e}).then(function(e){if(e)return r;throw new Error})}},{key:"keyAt",value:function(t,n){return e.findKey(t,function(){return 0===n--})}},{key:"at",value:function(t,n){return e.keyAt(t,n).then(l["default"](t.get,t))}},{key:"contains",value:function(t,n){return e.some(t,function(e){return e===n})}}]),e}();n.AsyncIterator=a,n["default"]=a},{"./bind":3}],3:[function(e,t,n){"use strict";function r(e,t){return function(){for(var n=arguments.length,r=Array(n),u=0;n>u;u++)r[u]=arguments[u];return e.apply(t,r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.bind=r,n["default"]=r},{}],4:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var u=function o(e){var t=this;r(this,o),this.get=function(e){return e in t._byKey?Promise.resolve(t._byKey[e]):t._list.get(e).then(function(n){return t._byKey[e]=n})},this.prev=function(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];return e in t._prev?Promise.resolve(t._prev[e]):t._list.prev(e).then(function(n){return t._prev[e]=n,t._next[n]=e,n})},this.next=function(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];return e in t._next?Promise.resolve(t._next[e]):t._list.next(e).then(function(n){return t._next[e]=n,t._prev[n]=e,n})},this._byKey=Object.create(null),this._next=Object.create(null),this._prev=Object.create(null),this._list=e};n.Cache=u,n["default"]=u},{}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e){return a.MutableList.isMutableList(e)?a.MutableList.create(e):l.ObservableList.isObservableList(e)?l.ObservableList.create(e):i.List.isList(e)?i.List.create(e):Array.isArray(e)?new v["default"](e):s["default"].create(e)}function o(e){var t=new s["default"];return e.then(function(e){t.push(e)}),l.ObservableList.create(t)}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=u,n.fromPromise=o;var i=e("./list"),l=e("./observable_list"),a=e("./mutable_list"),c=e("./unit"),s=r(c),f=e("./array_list"),v=r(f)},{"./array_list":1,"./list":9,"./mutable_list":11,"./observable_list":15,"./unit":18}],6:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var u=e("./list"),o=function i(e){var t=this;r(this,i),this._add=function(e,n){t._byIndex[n]=e},this.get=function(e){return e>=0&&e<t._byIndex.length?t._list.get(t._byIndex[e]):u.List.find(t,function(t,n){return n===e},t._byIndex.length-1)},this.prev=function(e){return null!=e&&e>=0&&e<t._byIndex.length?Promise.resolve(0>e-1?null:e-1):u.List.some(t,function(t,n){return n===e-1},t._byIndex.length-1).then(function(n){if(n)return e-1;if(null==e)return t._byIndex.length-1;throw new Error})},this.next=function(e){var n=null==e?0:e+1;return n<t._byIndex.length?Promise.resolve(n):u.List.some(t._list,function(e,r){return t._add(r,t._byIndex.length),n===t._byIndex.length-1},t._byIndex[t._byIndex.length-1]).then(function(e){if(e)return n;if(n===t._byIndex.length)return null;throw new Error})},this._byIndex=[],this._list=e};n.Index=o,n["default"]=o},{"./list":9}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r;!function(e){function t(e){return e.toString()}function n(){return r++}var r=0;e.key=t,e.create=n}(r||(r={})),n["default"]=r,t.exports=n["default"]},{}],8:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(e,t,n){for(var r=!0;r;){var u=e,o=t,i=n;l=c=a=void 0,r=!1,null===u&&(u=Function.prototype);var l=Object.getOwnPropertyDescriptor(u,o);if(void 0!==l){if("value"in l)return l.value;var a=l.get;return void 0===a?void 0:a.call(i)}var c=Object.getPrototypeOf(u);if(null===c)return void 0;e=c,t=o,n=i,r=!0}},c=e("./key"),s=r(c),f=e("./observable_list"),v=e("./mutable_list"),y=function(e){function t(e,n){o(this,t),a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this._keyFn=s["default"].create,n&&(this._keyFn=n),this._subject=new f.ListSubject,this._byKey=Object.create(null),this._prev=Object.create(null),this._next=Object.create(null),this._prev[null]=null,this._next[null]=null,this.splice.apply(this,[null,null].concat(u(e)))}return i(t,e),l(t,[{key:"get",value:function(e){return e in this._byKey?Promise.resolve(this._byKey[e]):Promise.reject(new Error)}},{key:"prev",value:function(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];return e in this._prev?Promise.resolve(this._prev[e]):Promise.reject(new Error)}},{key:"next",value:function(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];return e in this._next?Promise.resolve(this._next[e]):Promise.reject(new Error)}},{key:"set",value:function(e,t){return e in this._byKey?(this._byKey[e]=t,this._subject.onInvalidate([this._prev[e],this._next[e]]),Promise.resolve()):Promise.reject(new Error)}},{key:"splice",value:function(){for(var e,t=arguments.length<=0||void 0===arguments[0]?null:arguments[0],n=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=t;null!=(r=this._next[r])&&(delete this._next[this._prev[r]],delete this._prev[r],r!=n);)delete this._byKey[r];var u=n,o=!0,i=!1,l=void 0;try{for(var a=arguments.length,c=Array(a>2?a-2:0),s=2;a>s;s++)c[s-2]=arguments[s];for(var f,v=c[Symbol.iterator]();!(o=(f=v.next()).done);o=!0)e=f.value,r=this._keyFn(e),r in this._byKey&&this.splice(this._prev[r],this._next[r]),this._byKey[r]=e,this._prev[r]=u,this._next[u]=r,u=r}catch(y){i=!0,l=y}finally{try{!o&&v["return"]&&v["return"]()}finally{if(i)throw l}}return this._prev[n]=u,this._next[u]=n,this._subject.onInvalidate([t,n]),Promise.resolve()}},{key:"observe",value:function(e){return this._subject.observe(e)}}]),t}(v.MutableList);n["default"]=y,t.exports=n["default"]},{"./key":7,"./mutable_list":11,"./observable_list":15}],9:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(e,t,n){for(var r=!0;r;){var u=e,o=t,i=n;l=c=a=void 0,r=!1,null===u&&(u=Function.prototype);var l=Object.getOwnPropertyDescriptor(u,o);if(void 0!==l){if("value"in l)return l.value;var a=l.get;return void 0===a?void 0:a.call(i)}var c=Object.getPrototypeOf(u);if(null===c)return void 0;e=c,t=o,n=i,r=!0}},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("./bind"),c=r(a),s=e("./tree"),f=e("./cache"),v=r(f),y=e("./index"),h=r(y),p=function(){function e(){o(this,e)}return l(e,[{key:"_add",value:function(t,n){return e.create(e._add(this,t,n))}},{key:"_remove",value:function(t){return e.create(e._remove(this,t))}},{key:"reverse",value:function(){return e.create(e.reverse(this))}},{key:"map",value:function(t){return e.create(e.map(this,t))}},{key:"filter",value:function(t){return e.create(e.filter(this,t))}},{key:"flatten",value:function(){return e.create(e.flatten(this))}},{key:"flatMap",value:function(t){return e.create(e.flatMap(this,t))}},{key:"cache",value:function(){return e.create(e.cache(this))}},{key:"group",value:function(t){return e.create(e.group(this,t)).map(e.create).cache()}},{key:"index",value:function(){return e.create(e.index(this))}},{key:"zip",value:function(t,n){return e.create(e.zip(this,t,n))}},{key:"skip",value:function(t){return e.create(e.skip(this,t))}},{key:"take",value:function(t){return e.create(e.take(this,t))}},{key:"range",value:function(t,n){return e.create(e.range(this,t,n))}},{key:"scan",value:function(t,n){return e.create(e.scan(this,t,n))}}],[{key:"create",value:function(t){return new(function(e){function n(){o(this,n),i(Object.getPrototypeOf(n.prototype),"constructor",this).apply(this,arguments)}return u(n,e),l(n,[{key:"get",value:function(e){return t.get(e)}},{key:"prev",value:function(e){return t.prev(e)}},{key:"next",value:function(e){return t.next(e)}}]),n}(e))}},{key:"_add",value:function(e,t,n){function r(r){return r==t?Promise.resolve(n):e.get(r)}function u(n){return null==n?Promise.resolve(t):n==t?e.prev():e.prev(n)}function o(n){return n==t?Promise.resolve(null):e.next(n).then(function(e){return null==e?t:e})}return{get:r,prev:u,next:o}}},{key:"_remove",value:function(e,t){function n(n){return n==t?Promise.reject(new Error):e.get(n)}function r(n){return n==t?Promise.reject(new Error):e.prev(n).then(function(n){return n==t?e.prev(n):n})}function u(n){return n==t?Promise.reject(new Error):e.next(n).then(function(n){return n==t?e.next(n):n})}return{get:n,prev:r,next:u}}},{key:"isList",value:function(e){return null!=e&&!!e.get&&!!e.prev&&!!e.next}},{key:"first",value:function(e){var t=c["default"](e.get,e);return e.next().then(t)}},{key:"last",value:function(e){var t=c["default"](e.get,e);return e.prev().then(t)}},{key:"reverse",value:function(e){var t=c["default"](e.get,e),n=c["default"](e.next,e),r=c["default"](e.prev,e);return{get:t,prev:n,next:r}}},{key:"map",value:function(e,t){function n(n){return e.get(n).then(function(e){return t(e,n)})}var r=c["default"](e.prev,e),u=c["default"](e.next,e);return{get:n,prev:r,next:u}}},{key:"filter",value:function(t,n){function r(e){return t.get(e).then(function(e){if(n(e))return e;throw new Error})}function u(r){return e.findKey(e.reverse(t),n,[r,null])}function o(r){return e.findKey(t,n,[r,null])}return{get:r,prev:u,next:o}}},{key:"flatten",value:function(e){function t(t){var n=s.Path.fromKey(t);return s.Tree.get(e,n,1)}function n(t){var n=s.Path.fromKey(t);return s.Tree.prev(e,n,1).then(s.Path.toKey)}function r(t){var n=s.Path.fromKey(t);return s.Tree.next(e,n,1).then(s.Path.toKey)}return{get:t,prev:n,next:r}}},{key:"flatMap",value:function(t,n){return e.flatten(e.map(t,n))}},{key:"cache",value:function(e){return new v["default"](e)}},{key:"group",value:function(t,n){function r(r){return e.findKey(t,function(e,t){return n(e,t)===r}).then(function(){return i[r]=e.filter(t,function(e,t){return r===n(e,t)})})}function u(r){return e.findKey(e.reverse(t),function(e,t){var u=n(e,t);return u!==r&&!i[u]}).then(function(e){return null==e?null:t.get(e).then(function(t){return n(t,e)})})}function o(r){return e.findKey(t,function(e,t){var u=n(e,t);return u!==r&&!i[u]}).then(function(e){return null==e?null:t.get(e).then(function(t){return n(t,e)})})}var i=Object.create(null);return new v["default"]({get:r,prev:u,next:o})}},{key:"index",value:function(e){return new h["default"](e)}},{key:"zip",value:function(t,n,r){function u(e){return t.get(e).then(function(t){return n.get(e).then(function(e){return r(t,e)})})}function o(e){return t.prev(e).then(function(){return n.prev(e)})}function i(e){return t.next(e).then(function(){return n.next(e)})}return t=e.index(t),n=e.index(n),{get:u,prev:o,next:i}}},{key:"skip",value:function(t,n){return e.filter(e.index(t),function(e,t){return t>=n})}},{key:"take",value:function(t,n){return e.filter(e.index(t),function(e,t){return n>t})}},{key:"range",value:function(t,n,r){return e.filter(e.index(t),function(e,t){return t>=n&&r+n>t})}},{key:"scan",value:function(t,n,r){function u(e){return o.prev(e).then(function(e){return null==e?r:o.get(e)}).then(function(r){return t.get(e).then(function(t){return n(r,t,e)})})}var o,i=t.prev,l=t.next;return o=e.cache({get:u,prev:i,next:l})}}]),e}();n.List=p,n["default"]=p},{"./bind":3,"./cache":4,"./index":6,"./tree":17}],10:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var i=function(e,t,n){for(var r=!0;r;){var u=e,o=t,i=n;l=c=a=void 0,r=!1,null===u&&(u=Function.prototype);var l=Object.getOwnPropertyDescriptor(u,o);if(void 0!==l){if("value"in l)return l.value;var a=l.get;return void 0===a?void 0:a.call(i)}var c=Object.getPrototypeOf(u);if(null===c)return void 0;e=c,t=o,n=i,r=!0}},l=e("./observable_cache"),a=r(l),c=function(e){function t(e){var n=this;u(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.set=function(e,t){return n._list.set(e,t)},this.splice=function(e,t){for(var r=arguments.length,u=Array(r>2?r-2:0),o=2;r>o;o++)u[o-2]=arguments[o];var i;return(i=n._list).splice.apply(i,[e,t].concat(u))}}return o(t,e),t}(a["default"]);n.MutableCache=c,n["default"]=c},{"./observable_cache":13}],11:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){var n=[],r=!0,u=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(a){u=!0,o=a}finally{try{!r&&l["return"]&&l["return"]()}finally{if(u)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function(e,t,n){for(var r=!0;r;){var u=e,o=t,i=n;l=c=a=void 0,r=!1,null===u&&(u=Function.prototype);var l=Object.getOwnPropertyDescriptor(u,o);if(void 0!==l){if("value"in l)return l.value;var a=l.get;return void 0===a?void 0:a.call(i)}var c=Object.getPrototypeOf(u);if(null===c)return void 0;e=c,t=o,n=i,r=!0}},s=e("./observable_list"),f=e("./mutable_cache"),v=r(f),y=function(e){function t(){o(this,t),c(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return i(t,e),a(t,[{key:"addBefore",value:function(e,n){return t.addBefore(this,e,n)}},{key:"addAfter",value:function(e,n){return t.addAfter(this,e,n)}},{key:"push",value:function(e){return t.push(this,e)}},{key:"unshift",value:function(e){return t.unshift(this,e)}},{key:"delete",value:function(e){return t["delete"](this,e)}},{key:"deleteBefore",value:function(e){return t.deleteBefore(this,e)}},{key:"deleteAfter",value:function(e){return t.deleteAfter(this,e)}},{key:"pop",value:function(){return t.pop(this)}},{key:"shift",value:function(){return t.shift(this)}},{key:"remove",value:function(e){return t.remove(this,e)}},{key:"cache",value:function(){return t.create(t.cache(this))}},{key:"map",value:function(e,n){return t.create(t.map(this,e,n))}}],[{key:"create",value:function(e){return new(function(t){function n(){o(this,n),c(Object.getPrototypeOf(n.prototype),"constructor",this).apply(this,arguments)}return i(n,t),a(n,[{key:"get",value:function(t){return e.get(t)}},{key:"prev",value:function(t){return e.prev(t)}},{key:"next",value:function(t){return e.next(t)}},{key:"observe",value:function(t){return e.observe(t)}},{key:"set",value:function(t,n){return e.set(t,n)}},{key:"splice",value:function(t,n){for(var r=arguments.length,u=Array(r>2?r-2:0),o=2;r>o;o++)u[o-2]=arguments[o];return e.splice.apply(e,[t,n].concat(u))}}]),n}(t))}},{key:"isMutableList",value:function(e){return s.ObservableList.isObservableList(e)&&!!e.set&&!!e.splice}},{key:"addBefore",value:function(e,t,n){return e.prev(t).then(function(r){return e.splice(r,t,n)}).then(function(){return e.prev(t)})}},{key:"addAfter",value:function(e,t,n){return e.next(t).then(function(r){return e.splice(t,r,n)}).then(function(){return e.next(t)})}},{key:"push",value:function(e,n){return t.addBefore(e,null,n)}},{key:"unshift",value:function(e,n){return t.addAfter(e,null,n)}},{key:"delete",value:function(e,t){return e.get(t).then(function(n){return Promise.all([e.prev(t),e.next(t)]).then(function(t){var n=l(t,2),r=n[0],u=n[1];return e.splice(r,u)}).then(function(){return n})})}},{key:"deleteBefore",value:function(e,n){return e.prev(n).then(function(n){return t["delete"](e,n)})}},{key:"deleteAfter",value:function(e,n){return e.next(n).then(function(n){return t["delete"](e,n)})}},{key:"pop",value:function(e){return t.deleteBefore(e,null)}},{key:"shift",value:function(e){return t.deleteAfter(e,null)}},{key:"remove",value:function(e,n){return t.keyOf(e,n).then(function(n){t["delete"](e,n)})}},{key:"cache",value:function(e){return new v["default"](e)}},{key:"map",value:function(e,t,n){function r(t,r){return Promise.resolve(n(r,t)).then(function(n){return e.set(t,n)})}function o(t,r){for(var o=arguments.length,i=Array(o>2?o-2:0),l=2;o>l;l++)i[l-2]=arguments[l];return Promise.all(i.map(function(e){return n(e)})).then(function(n){return e.splice.apply(e,[t,r].concat(u(n)))})}var i=s.ObservableList.map(e,t),l=i.get,a=i.prev,c=i.next,f=i.observe;return{get:l,prev:a,next:c,observe:f,set:r,splice:o}}}]),t}(s.ObservableList);n.MutableList=y,n["default"]=y},{"./mutable_cache":10,"./observable_list":15}],12:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./key"),i=r(o),l=function a(){var e=this;u(this,a),this.observe=function(t){var n=i["default"].create();return e._observers[n]=t,{unsubscribe:function(){delete e._observers[n]}}},this.notify=function(t){for(var n in e._observers)t(e._observers[n])},this._observers=Object.create(null)};n.Subject=l},{"./key":7}],13:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){var n=[],r=!0,u=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(a){u=!0,o=a}finally{try{!r&&l["return"]&&l["return"]()}finally{if(u)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=function(e,t,n){for(var r=!0;r;){var u=e,o=t,i=n;l=c=a=void 0,r=!1,null===u&&(u=Function.prototype);var l=Object.getOwnPropertyDescriptor(u,o);if(void 0!==l){if("value"in l)return l.value;var a=l.get;return void 0===a?void 0:a.call(i)}var c=Object.getPrototypeOf(u);if(null===c)return void 0;e=c,t=o,n=i,r=!0}},a=e("./cache"),c=r(a),s=e("./observable_list"),f=function(e){function t(e){var n=this;u(this,t),l(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.observe=function(e){return n._subject.observe(e)},this.onInvalidate=function(e){if(!Array.isArray(e)){var t=n._prev[e],r=n._next[e];return null!=t&&(delete n._next[t],delete n._prev[e]),null!=r&&(delete n._prev[r],delete n._next[e]),delete n._byKey[e],n._subject.onInvalidate(e)}var u,o=i(e,2),t=o[0],r=o[1];for(u=t;void 0!==(u=n._next[u])&&(delete n._next[n._prev[u]],delete n._prev[u],u!=r);)delete n._byKey[u];for(u=r;void 0!==(u=n._prev[u])&&(delete n._prev[n._next[u]],delete n._next[u],u!=t);)delete n._byKey[u];n._subject.onInvalidate(e)},this._subject=new s.ListSubject,e.observe(this)}return o(t,e),t}(c["default"]);n.ObservableCache=f,n["default"]=f},{"./cache":4,"./observable_list":15}],14:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var i=function(e,t,n){for(var r=!0;r;){var u=e,o=t,i=n;l=c=a=void 0,r=!1,null===u&&(u=Function.prototype);var l=Object.getOwnPropertyDescriptor(u,o);if(void 0!==l){if("value"in l)return l.value;var a=l.get;return void 0===a?void 0:a.call(i)}var c=Object.getPrototypeOf(u);if(null===c)return void 0;e=c,t=o,n=i,r=!0}},l=e("./index"),a=r(l),c=e("./observable_list"),s=function(e){function t(e){var n=this;u(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this._add=function(e,t){n._byIndex[t]=e,n._byKey[e]=t},this.observe=function(e){return n._subject.observe(e)},this.onInvalidate=function(e){for(var t,r=n._byIndex.length,t=Array.isArray(e)?n._byKey[e[0]]:n._byKey[e];t++<r;)delete n._byKey[n._byIndex[t]];n._byIndex.splice(t),n._subject.onInvalidate([0==t?null:t-1,null])},this._byKey=Object.create(null),this._subject=new c.ListSubject,e.observe(this)}return o(t,e),t}(a["default"]);n.ObservableIndex=s,n["default"]=s},{"./index":6,"./observable_list":15}],15:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function(e,t,n){for(var r=!0;r;){var u=e,o=t,i=n;l=c=a=void 0,r=!1,null===u&&(u=Function.prototype);var l=Object.getOwnPropertyDescriptor(u,o);if(void 0!==l){if("value"in l)return l.value;var a=l.get;return void 0===a?void 0:a.call(i)}var c=Object.getPrototypeOf(u);if(null===c)return void 0;e=c,t=o,n=i,r=!0}},a=e("./bind"),c=r(a),s=e("./list"),f=e("./tree"),v=e("./observable"),y=e("./observable_cache"),h=r(y),p=e("./observable_index"),d=r(p),b=function(e){function t(){var e=this;u(this,t);for(var n=arguments.length,r=Array(n),o=0;n>o;o++)r[o]=arguments[o];l(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,r),this.onInvalidate=function(t){e.notify(function(e){e.onInvalidate(t)})}}return o(t,e),t}(v.Subject);n.ListSubject=b;var _=function(e){function t(){u(this,t),l(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),i(t,[{key:"reverse",value:function(){return t.create(t.reverse(this))}},{key:"map",value:function(e){return t.create(t.map(this,e))}},{key:"filter",value:function(e){return t.create(t.filter(this,e))}},{key:"flatten",value:function(){return t.create(t.flatten(this))}},{key:"flatMap",value:function(e){return t.create(t.flatMap(this,e))}},{key:"cache",value:function(){return t.create(t.cache(this))}},{key:"index",value:function(){return t.create(t.index(this))}},{key:"zip",value:function(e,n){return t.create(t.zip(this,e,n))}},{key:"skip",value:function(e){return t.create(t.skip(this,e))}},{key:"take",value:function(e){return t.create(t.take(this,e))}},{key:"range",value:function(e,n){return t.create(t.range(this,e,n))}},{key:"scan",value:function(e,n){return t.create(t.scan(this,e,n))}}],[{key:"create",value:function(e){return new(function(t){function n(){u(this,n),l(Object.getPrototypeOf(n.prototype),"constructor",this).apply(this,arguments)}return o(n,t),i(n,[{key:"get",value:function(t){return e.get(t)}},{key:"prev",value:function(t){return e.prev(t)}},{key:"next",value:function(t){return e.next(t)}},{key:"observe",value:function(t){return e.observe(t)}}]),n}(t))}},{key:"isObservableList",value:function(e){return s.List.isList(e)&&!!e.observe}},{key:"reverse",value:function(e){function t(t){return e.observe({onInvalidate:function(e){t.onInvalidate(e)}})}var n=s.List.reverse(e),r=n.get,u=n.prev,o=n.next;return{get:r,prev:u,next:o,observe:t}}},{key:"map",value:function(e,t){var n=s.List.map(e,t),r=n.get,u=n.prev,o=n.next;
return{get:r,prev:u,next:o,observe:c["default"](e.observe,e)}}},{key:"filter",value:function(e,t){var n=s.List.filter(e,t),r=n.get,u=n.prev,o=n.next,i=c["default"](e.observe,e);return{get:r,prev:u,next:o,observe:i}}},{key:"flatten",value:function(e){function t(e){var t=function(t){return Array.isArray(t)?void o.onInvalidate([f.Path.toKey(null!=t[0]?[e,t[0]]:[e]),f.Path.toKey(null!=t[1]?[e,t[1]]:[e])]):o.onInvalidate(f.Path.toKey([e,t]))};return{onInvalidate:t}}function n(n){return u.prev(n).then(function(n){var r=f.Path.fromKey(n),u=f.Path.head(r);return null==u||i[u]||e.get(u).then(function(e){return i[u]=e.observe(t(u))}),n})}function r(n){return u.next(n).then(function(n){var r=f.Path.fromKey(n),u=f.Path.head(r);return null==u||i[u]||e.get(u).then(function(e){return i[u]=e.observe(t(u))}),n})}var u=s.List.flatten(e),o=new b,i=Object.create(null),l=new h["default"]({get:c["default"](e.get,e),prev:c["default"](e.prev,e),next:c["default"](e.next,e),observe:function(e){return null}});return e.observe({onInvalidate:function(e){s.List.forEach(l,function(e,t){i[t]&&(i[t].unsubscribe(),delete i[t])},e),Array.isArray(e)?o.onInvalidate([f.Path.toKey([e[0]]),f.Path.toKey([e[1]])]):o.onInvalidate(f.Path.toKey([e])),l.onInvalidate(e)}}),{get:u.get,prev:n,next:r,observe:o.observe}}},{key:"flatMap",value:function(e,n){return t.flatten(t.map(e,n))}},{key:"cache",value:function(e){return new h["default"](e)}},{key:"index",value:function(e){return new d["default"](e)}},{key:"zip",value:function(e,n,r){function u(t){return e.get(t).then(function(e){return n.get(t).then(function(t){return r(e,t)})})}function o(t){return e.prev(t).then(function(){return n.prev(t)})}function i(t){return e.next(t).then(function(){return n.next(t)})}e=t.index(e),n=t.index(n);var l=new b;return e.observe(l),n.observe(l),{get:u,prev:o,next:i,observe:l.observe}}},{key:"skip",value:function(e,n){return t.filter(t.index(e),function(e,t){return t>=n})}},{key:"take",value:function(e,n){return t.filter(t.index(e),function(e,t){return n>t})}},{key:"range",value:function(e,n,r){return t.filter(t.index(e),function(e,t){return t>=n&&r+n>t})}},{key:"scan",value:function(e,n,r){function u(t){return i.prev(t).then(function(e){return null==e?r:i.get(e)}).then(function(r){return e.get(t).then(function(e){return n(r,e,t)})})}function o(t){return e.observe({onInvalidate:function(n){Range.prev(e,n).then(function(e){return t.onInvalidate([e,null])})}})}var i,l=c["default"](e.prev,e),a=c["default"](e.next,e);return i=t.cache({get:u,prev:l,next:a,observe:o})}}]),t}(s.List);n.ObservableList=_,n["default"]=_},{"./bind":3,"./list":9,"./observable":12,"./observable_cache":13,"./observable_index":14,"./tree":17}],16:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e){return i["default"](e)}Object.defineProperty(n,"__esModule",{value:!0}),n.Sonic=u;var u,o=e("./factory"),i=r(o),l=e("./list"),a=r(l),c=e("./observable_list"),s=r(c),f=e("./mutable_list"),v=r(f),y=e("./unit"),h=r(y),p=e("./array_list"),d=r(p),b=e("./linked_list"),_=r(b),g=e("./async_iterator"),m=r(g),k=e("./tree");n.Sonic=u,function(e){e.List=a["default"],e.ObservableList=s["default"],e.MutableList=v["default"],e.Unit=h["default"],e.ArrayList=d["default"],e.LinkedList=_["default"],e.Tree=k.Tree,e.Path=k.Path,e.AsyncIterator=m["default"],e.fromPromise=o.fromPromise}(u||(n.Sonic=n.Sonic=u={})),t.exports=u,n["default"]=u},{"./array_list":1,"./async_iterator":2,"./factory":5,"./linked_list":8,"./list":9,"./mutable_list":11,"./observable_list":15,"./tree":17,"./unit":18}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,u=e("./list");n.Path=r,function(e){function t(e){return JSON.stringify(e)}function n(e){return null==e?null:JSON.parse(e.toString())}function r(e){return null==e?null:JSON.stringify(e)}function u(e){return e?e[0]:null}function o(e,t){return e[t]}function i(e){return null==e?[]:e.slice(1,e.length)}function l(e,t){return[].concat(e).concat(t)}e.key=t,e.fromKey=n,e.toKey=r,e.head=u,e.get=o,e.tail=i,e.append=l}(r||(n.Path=r={}));var o;n.Tree=o,function(e){function t(t,n){var u=arguments.length<=2||void 0===arguments[2]?1/0:arguments[2],o=r.head(n),i=r.tail(n);return t.get(o).then(function(t){return 0==i.length||0==u?t:e.get(t,i,u)})}function n(t){var n=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],o=arguments.length<=2||void 0===arguments[2]?1/0:arguments[2],i=r.head(n),l=r.tail(n);return(null==i||!l.length)&&o>0?t.prev(i).then(function(n){return null==n?null:t.get(n).then(function(t){return u.List.isList(t)?e.prev(t,null,o-1).then(function(e){return null==e?null:r.append(n,e)}):[n]})}):l.length&&o>0?t.get(i).then(function(t){return e.prev(t,l,o-1)}).then(function(n){return null!=n?r.append(i,n):t.prev(i).then(function(n){return null==n?null:t.get(n).then(function(t){return e.prev(t,null,o-1)}).then(function(e){return r.append(n,e)})})}):t.prev(i).then(function(e){return null!=e?[e]:null})}function o(t){var n=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],o=arguments.length<=2||void 0===arguments[2]?1/0:arguments[2],i=r.head(n),l=r.tail(n);return(null==i||!l.length)&&o>0?t.next(i).then(function(n){return null==n?null:t.get(n).then(function(t){return u.List.isList(t)?e.next(t,null,o-1).then(function(e){return null==e?null:r.append(n,e)}):[n]})}):l.length&&o>0?t.get(i).then(function(t){return e.next(t,l,o-1)}).then(function(n){return null!=n?r.append(i,n):t.next(i).then(function(n){return null==n?null:t.get(n).then(function(t){return e.next(t,null,o-1)}).then(function(e){return r.append(n,e)})})}):t.next(i).then(function(e){return null!=e?[e]:null})}function i(e,n,r){var u=n.slice(0,n.length-1),o=n[n.length-1];return t(e,u).then(function(e){return e.set(o,r)})}function l(e,n,r){for(var u=arguments.length,o=Array(u>3?u-3:0),i=3;u>i;i++)o[i-3]=arguments[i];var l=n.slice(0,n.length-1),a=n[n.length-1],c=(r.slice(0,r.length-1),r[r.length-1]);return t(e,l).then(function(e){return e.splice.apply(e,[a,c].concat(o))})}e.get=t,e.prev=n,e.next=o,e.set=i,e.splice=l}(o||(n.Tree=o={})),n["default"]=o},{"./list":9}],18:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function(e,t,n){for(var r=!0;r;){var u=e,o=t,i=n;l=c=a=void 0,r=!1,null===u&&(u=Function.prototype);var l=Object.getOwnPropertyDescriptor(u,o);if(void 0!==l){if("value"in l)return l.value;var a=l.get;return void 0===a?void 0:a.call(i)}var c=Object.getPrototypeOf(u);if(null===c)return void 0;e=c,t=o,n=i,r=!0}},a=e("./key"),c=r(a),s=e("./observable_list"),f=e("./mutable_list"),v=function(e){function t(e){u(this,t),l(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this._subject=new s.ListSubject,arguments.length&&this.splice(null,null,e)}return o(t,e),i(t,[{key:"get",value:function(e){return e===this._key?Promise.resolve(this._value):void Promise.reject(new Error)}},{key:"prev",value:function(e){return null==e?Promise.resolve(this._key):e===this._key?Promise.resolve(null):Promise.reject(new Error)}},{key:"next",value:function(e){return null==e?Promise.resolve(this._key):e===this._key?Promise.resolve(null):Promise.reject(new Error)}},{key:"set",value:function(e,t){return this._key=e,this._value=t,this._subject.onInvalidate([null,null]),Promise.resolve()}},{key:"splice",value:function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),u=2;n>u;u++)r[u-2]=arguments[u];return r.length?this.set(c["default"].create(),r[0]):(delete this._key,delete this._value,this._subject.onInvalidate([null,null]),Promise.resolve())}},{key:"observe",value:function(e){return this._subject.observe(e)}}]),t}(f.MutableList);n["default"]=v,t.exports=n["default"]},{"./key":7,"./mutable_list":11,"./observable_list":15}]},{},[16])(16)});