!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Sonic=e()}}(function(){return function e(t,n,r){function u(i,c){if(!n[i]){if(!t[i]){var a="function"==typeof require&&require;if(!c&&a)return a(i,!0);if(o)return o(i,!0);var f=new Error("Cannot find module '"+i+"'");throw f.code="MODULE_NOT_FOUND",f}var s=n[i]={exports:{}};t[i][0].call(s.exports,function(e){var n=t[i][1][e];return u(n?n:e)},s,s.exports,e,t,n,r)}return n[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)u(r[i]);return u}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,u=e("./state"),o=e("./list"),i=e("./mutable");n.factory=r,function(e){e.State=u.factory,e.List=o.factory,e.Mutable=i.factory}(r||(n.factory=r={})),n["default"]=r},{"./list":3,"./mutable":4,"./state":7}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r;!function(e){function t(e){return e.toString()}function n(){return r++}var r=0;e.key=t,e.create=n}(r||(r={})),n["default"]=r,t.exports=n["default"]},{}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,o=e("./state"),i=r(o),c=e("./observable"),a=e("./patch");n.List=u,function(e){function t(e){function t(t,n,r){return{get:function(n){return t[n]==s?Promise.reject(new Error):void 0===t[n]?t[n]=e.state.get(n):t[n]},prev:function(t){return void 0===n[t]?e.state.prev(t).then(function(e){return r[e]=t,n[t]=e}):Promise.resolve(n[t])},next:function(t){return void 0===r[t]?e.state.next(t).then(function(e){return n[e]=t,r[t]=e}):Promise.resolve(r[t])}}}var n=new c.Subject,r={get:Object.create(null),prev:Object.create(null),next:Object.create(null)},u=Object.defineProperties({subscribe:n.subscribe},{state:{get:function(){return t(r.get,r.prev,r.next)},configurable:!0,enumerable:!0}});return e.subscribe({onNext:function(e){return Promise.resolve().then(function(){var t=u.state;return r={get:Object.create(r.get),prev:Object.create(r.prev),next:Object.create(r.next)},a.Patch.isSetPatch(e)&&(r.get[e.key]=Promise.resolve(e.value),void 0!==e.before)?t.prev(e.before).then(function(t){var n=e.before;r.prev[n]=e.key,r.next[e.key]=n,r.prev[e.key]=t,r.next[t]=e.key}):a.Patch.isDeletePatch(e)?(r.get[e.key]=s,t.prev(e.key).then(function(t){return u.state.next(e.key).then(function(e){return r.prev[e]=t,r.next[t]=e})})):void 0}).then(function(){return n.onNext(e)})}}),u}function n(e,t){var n=i["default"].map(e.state,t),r=c.Observable.map(e,function(e){return a.Patch.isSetPatch(e)?Promise.resolve(t(e.value,e.key)).then(function(t){return{operation:a.Patch.SET,key:e.key,value:t,before:e.before}}):e});return f.create(n,r)}function r(e,t){var n=i["default"].filter(e.state,t),r=c.Observable.map(e,function(e){return a.Patch.isSetPatch(e)?Promise.resolve(t(e.value,e.key)).then(function(t){return t?e:{operation:a.Patch.DELETE,key:e.key}}):e});return f.create(n,r)}function u(e,t){var n=i["default"].zoom(e.state,t),r=c.Observable.filter(e,function(e){return e.key===t});return f.create(n,r)}function o(e){var t,n=c.Observable.map(e,function(e){return a.Patch.isSetPatch(e)?void 0===e.before?e:t.state.next(e.before).then(function(t){return{operation:a.Patch.SET,key:e.key,value:e.value,before:t}}):e});return t={state:i["default"].reverse(e.state),subscribe:n.subscribe},n.subscribe({onNext:function(e){t.state=i["default"].patch(t.state,e)}}),t}var s=Promise.resolve({});e.cache=t,e.map=n,e.filter=r,e.zoom=u,e.reverse=o}(u||(n.List=u={}));var f;n.factory=f,function(e){function t(e,t){var n={state:e,subscribe:t.subscribe};return t.subscribe({onNext:function(e){n.state=i["default"].patch(n.state,e)}}),n}e.create=t}(f||(n.factory=f={})),n["default"]=u},{"./observable":5,"./patch":6,"./state":7}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,o=e("./observable"),i=e("./patch"),c=e("./list"),a=e("./state_iterator"),f=r(a);n.Mutable=u,function(e){function t(e,t,u){var o=function(r,u,o){return Promise.resolve(r).then(function(){return n(e,o,u,t[1])})};return f["default"].reduce(u,o,f["default"].every(e.state,function(t,n){return r(e,n).then(function(){return!0})}).then(function(){}))}function n(e,t,n,r){var u={operation:i.Patch.SET,key:t,value:n};return void 0!==r&&(u.before=r),e.modify(u)}function r(e,t){var n={operation:i.Patch.DELETE,key:t};return e.modify(n)}e.splice=t,e.set=n,e.del=r}(u||(n.Mutable=u={}));var s;n.factory=s,function(e){function t(e){var t=new o.Subject,n=c.factory.create(e,t);return Object.defineProperties({subscribe:n.subscribe,modify:function(e){return t.onNext(e)}},{state:{get:function(){return n.state},configurable:!0,enumerable:!0}})}e.create=t}(s||(n.factory=s={})),n["default"]=u},{"./list":3,"./observable":5,"./patch":6,"./state_iterator":8}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){var t=!1;return{dispose:function(){t||(t=!0,e())}}}Object.defineProperty(n,"__esModule",{value:!0}),n.disposable=o;var i=e("./key"),c=r(i),a=function s(){var e=this;u(this,s),this._count=0,this.subscribe=function(t){var n=c["default"].create();return e._observers[n]=t,o(function(){return delete e._observers[n]})},this.onNext=function(t){return Promise.all(Object.keys(e._observers).map(function(n){return e._observers[n].onNext(t)})).then(function(){})},this._observers=Object.create(null)};n.Subject=a;var f;n.Observable=f,function(e){function t(e,t){var n=new a;return e.subscribe({onNext:function(e){return Promise.resolve(t(e)).then(n.onNext)}}),{subscribe:n.subscribe}}function n(e,t){var n=new a;return e.subscribe({onNext:function(e){return Promise.resolve(t(e)).then(function(t){return t?n.onNext(e):void 0})}}),{subscribe:n.subscribe}}e.map=t,e.filter=n}(f||(n.Observable=f={}))},{"./key":2}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r;n.Patch=r,function(e){function t(t){return t.operation===e.SET}function n(t){return t.operation===e.DELETE}e.SET="set",e.DELETE="delete",e.isSetPatch=t,e.isDeletePatch=n}(r||(n.Patch=r={})),n["default"]=r},{}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var u,o=e("./state_iterator"),i=r(o),c=e("./patch"),a=e("./xhr"),f=r(a);n.State=u,function(e){function t(e,t){var n=t.get,r=t.prev,u=t.next,o=Object.create(e);return n&&(o.get=n),r&&(o.prev=r),u&&(o.next=u),o}function n(e,n){var r=e;return c.Patch.isSetPatch(n)&&(r=t(r,u(r,n.key,n.value,n.before))),c.Patch.isDeletePatch(n)&&(r=t(r,o(r,n.key))),r}function r(e,t){return t.reduce(function(e,t){return n(e,t)},e)}function u(e,n,r,u){var o={get:function(t){return t===n?Promise.resolve(r):e.get(t)}};return void 0!==u&&(o.prev=function(){var t=void 0===arguments[0]?null:arguments[0];return t===u?Promise.resolve(n):e.prev(t==n?u:t)},o.next=function(){var t=void 0===arguments[0]?null:arguments[0];return t===n?Promise.resolve(u):e.next(t).then(function(e){return e==u?n:e})}),t(e,o)}function o(n,r){return t(n,{get:function(t){return t!==r?n.get(t):e.NOT_FOUND},prev:function(){var e=void 0===arguments[0]?null:arguments[0];return n.prev(e).then(function(e){return e===r?n.prev(e):e})},next:function(){var e=void 0===arguments[0]?null:arguments[0];return n.next(e).then(function(e){return e===r?n.next(e):e})}})}function a(e){return t(e,{prev:e.next,next:e.prev})}function f(e,n){return t(e,{get:function(t){return e.get(t).then(function(e){return n(e,t)})}})}function s(n,r){return t(n,{get:function(t){return n.get(t).then(function(t){return r(t)?t:e.NOT_FOUND})},prev:function(t){return i["default"].findKey(e.reverse(n),r,[t,null])},next:function(e){return i["default"].findKey(n,r,[e,null])}})}function l(n,r){var u=function(t){return null==t?Promise.resolve(r):t===r?Promise.resolve(null):e.NOT_FOUND};return t(n,{get:function(t){return t===r?n.get(r):e.NOT_FOUND},prev:u,next:u})}e.extend=t,e.patch=n,e.patches=r,e.set=u,e.del=o,e.reverse=a,e.map=f,e.filter=s,e.zoom=l}(u||(n.State=u={})),Object.defineProperty(u,"NOT_FOUND",{get:function(){return Promise.reject("No entry at the specified key")}});var s;n.factory=s,function(e){function t(e){return{get:function(t){return t in e?Promise.resolve(e[t]):Promise.reject(new Error)},prev:function(t){var n=null==t?e.length-1:t-1;return Promise.resolve(-1==n?null:n)},next:function(t){var n=null==t?0:t+1;return Promise.resolve(n==e.length?null:n)}}}function n(e){var t=Object.keys(e),n={"null":-1};return{get:function(t){return t in e?Promise.resolve(e[t]):Promise.reject(new Error)},prev:function(r){var u=null==r?t.length-1:n[r]-1;return n[t[u]]=u,null==r?Promise.resolve(t[t.length-1]):r in e?Promise.resolve(-1==u?null:t[u]):Promise.reject(new Error)},next:function(r){var u=n[r]+1;return n[t[u]]=u,null==r?Promise.resolve(t[0]):r in e?Promise.resolve(u==t.length?null:t[u]):Promise.reject(new Error)}}}function r(e){function t(){return f["default"].get(e).then(function(e){return e.responseText}).then(JSON.parse).then(function(e){return r=n(e.reduce(function(e,t){return e[t.id]=t,e},{}))})}var r;return{get:function(t){return r?r.get(t):f["default"].get(e+"/"+t).then(function(e){return e.responseText}).then(JSON.parse)},prev:function(e){return r?r.prev(e):t().then(function(t){return t.prev(e)})},next:function(e){return r?r.next(e):t().then(function(t){return t.next(e)})}}}e.fromArray=t,e.fromObject=n,e.fromURL=r}(s||(n.factory=s={})),n["default"]=u},{"./patch":6,"./state_iterator":8,"./xhr":9}],8:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./state"),i=r(o),c=function a(e){var t=this,n=void 0===arguments[1]?[null,null]:arguments[1];u(this,a),this.get=function(){return t.state.get(t.current)},this.prev=function(){return t.state.prev(null==t.current?t.range[1]:t.current).then(function(e){return t.current=e==t.range[0]?null:e})},this.next=function(){return t.state.next(null==t.current?t.range[0]:t.current).then(function(e){return t.current=e==t.range[1]?null:e})},this.state=e,this.range=n};n.StateIterator=c,function(e){function t(e){var t=void 0===arguments[1]?[null,null]:arguments[1];return e.next(t[0]).then(e.get)}function n(e){var t=void 0===arguments[1]?[null,null]:arguments[1];return e.prev(t[1]).then(e.get)}function r(t,n,r){function u(){return o.next().then(function(e){return null==e||o.get().then(function(t){return n(t,e)}).then(function(e){return e?u():!1})})}var o=new e(t,r);return u()}function u(e,t,n){return r(e,function(e,n){return Promise.resolve(t(e,n)).then(function(e){return!e})},n).then(function(e){return!e})}function o(e,t,n){return r(e,function(e,n){return Promise.resolve(t(e,n)).then(function(){return!0})},n).then(function(){})}function c(e,t,n,r){return o(e,function(e,r){return Promise.resolve(t(n,e,r)).then(function(e){n=e})},r).then(function(){return n})}function a(e,t){return c(e,function(e,t){return e.push(t),e},[],t)}function f(e,t){return c(e,function(e,t,n){return e[n]=t,e},Object.create(null),t)}function s(e,t,n){var r;return u(e,function(e,n){return Promise.resolve(t(e,n)).then(function(e){return e?(r=n,!0):!1})},n).then(function(e){return e?r:null})}function l(e,t,n){return s(e,t,n).then(e.get)}function v(e,t,n){return s(e,function(e){return e===t},n)}function d(e,t,n){var r=-1;return u(e,function(e,n){return r++,t==e},n).then(function(e){return e?r:void i["default"].NOT_FOUND})}function b(e,t,n){return s(e,function(){return 0===t--},n)}function h(e,t,n){return b(e,t,n).then(e.get)}function p(e,t,n){return u(e,function(e){return e===t},n)}e.first=t,e.last=n,e.every=r,e.some=u,e.forEach=o,e.reduce=c,e.toArray=a,e.toObject=f,e.findKey=s,e.find=l,e.keyOf=v,e.indexOf=d,e.keyAt=b,e.at=h,e.contains=p}(c||(n.StateIterator=c={})),n["default"]=c},{"./state":7}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={create:function(e,t){return new Promise(function(n,r){var u=new XMLHttpRequest,o=e.toString(),i=t.method,c=t.body;u.onload=function(){u.status>=200&&u.status<400?n(u):r(u)},u.onerror=function(){r(u)},u.open(i,o,!0),u.setRequestHeader("Content-Type","application/json"),u.send(JSON.stringify(c))})},get:function(e){return r.create(e,{method:"GET"})},put:function(e,t){return r.create(e,{method:"PUT",body:t})},post:function(e,t){return r.create(e,{method:"POST",body:t})},"delete":function(e){return r.create(e,{method:"DELETE"})}};n.XHR=r,n["default"]=r},{}],10:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e){return e instanceof Array?b["default"].Mutable.create(b["default"].State.fromArray(e)):e instanceof Object?b["default"].Mutable.create(b["default"].State.fromObject(e)):void 0}Object.defineProperty(n,"__esModule",{value:!0}),n.Sonic=u;var u,o=e("./patch"),i=r(o),c=e("./state"),a=r(c),f=e("./state_iterator"),s=r(f),l=e("./list"),v=r(l),d=e("./factory"),b=r(d),h=e("./observable"),p=e("./mutable"),m=r(p);n.Sonic=u,function(e){e.Patch=i["default"],e.State=a["default"],e.StateIterator=s["default"],e.List=v["default"],e.factory=b["default"],e.Subject=h.Subject,e.Mutable=m["default"]}(u||(n.Sonic=n.Sonic=u={})),t.exports=u,n["default"]=u},{"./factory":1,"./list":3,"./mutable":4,"./observable":5,"./patch":6,"./state":7,"./state_iterator":8}]},{},[10])(10)});